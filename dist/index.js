/*! For license information please see index.js.LICENSE.txt */
var mapboxGlDrawSnapOnMode;(()=>{var t={568:function(t,e,n){t.exports=function(){"use strict";var t=function(t,e){var n={drag:[],click:[],mousemove:[],mousedown:[],mouseup:[],mouseout:[],keydown:[],keyup:[],touchstart:[],touchmove:[],touchend:[],tap:[]},r={on:function(t,e,r){if(void 0===n[t])throw new Error("Invalid event type: "+t);n[t].push({selector:e,fn:r})},render:function(t){e.store.featureChanged(t)}},o=function(t,o){for(var i=n[t],s=i.length;s--;){var a=i[s];if(a.selector(o)){a.fn.call(r,o)||e.store.render(),e.ui.updateMapClasses();break}}};return t.start.call(r),{render:t.render,stop:function(){t.stop&&t.stop()},trash:function(){t.trash&&(t.trash(),e.store.render())},combineFeatures:function(){t.combineFeatures&&t.combineFeatures()},uncombineFeatures:function(){t.uncombineFeatures&&t.uncombineFeatures()},drag:function(t){o("drag",t)},click:function(t){o("click",t)},mousemove:function(t){o("mousemove",t)},mousedown:function(t){o("mousedown",t)},mouseup:function(t){o("mouseup",t)},mouseout:function(t){o("mouseout",t)},keydown:function(t){o("keydown",t)},keyup:function(t){o("keyup",t)},touchstart:function(t){o("touchstart",t)},touchmove:function(t){o("touchmove",t)},touchend:function(t){o("touchend",t)},tap:function(t){o("tap",t)}}};function e(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function r(t){if(t.__esModule)return t;var e=t.default;if("function"==typeof e){var n=function t(){if(this instanceof t){var n=[null];return n.push.apply(n,arguments),new(Function.bind.apply(e,n))}return e.apply(this,arguments)};n.prototype=e.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(t).forEach((function(e){var r=Object.getOwnPropertyDescriptor(t,e);Object.defineProperty(n,e,r.get?r:{enumerable:!0,get:function(){return t[e]}})})),n}var o={},i={RADIUS:6378137,FLATTENING:1/298.257223563,POLAR_RADIUS:6356752.3142};function s(t){var e=0;if(t&&t.length>0){e+=Math.abs(a(t[0]));for(var n=1;n<t.length;n++)e-=Math.abs(a(t[n]))}return e}function a(t){var e,n,r,o,s,a,c=0,l=t.length;if(l>2){for(a=0;a<l;a++)a===l-2?(r=l-2,o=l-1,s=0):a===l-1?(r=l-1,o=0,s=1):(r=a,o=a+1,s=a+2),e=t[r],n=t[o],c+=(u(t[s][0])-u(e[0]))*Math.sin(u(n[1]));c=c*i.RADIUS*i.RADIUS/2}return c}function u(t){return t*Math.PI/180}o.geometry=function t(e){var n,r=0;switch(e.type){case"Polygon":return s(e.coordinates);case"MultiPolygon":for(n=0;n<e.coordinates.length;n++)r+=s(e.coordinates[n]);return r;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0;case"GeometryCollection":for(n=0;n<e.geometries.length;n++)r+=t(e.geometries[n]);return r}},o.ring=a;var c={CONTROL_BASE:"mapboxgl-ctrl",CONTROL_PREFIX:"mapboxgl-ctrl-",CONTROL_BUTTON:"mapbox-gl-draw_ctrl-draw-btn",CONTROL_BUTTON_LINE:"mapbox-gl-draw_line",CONTROL_BUTTON_POLYGON:"mapbox-gl-draw_polygon",CONTROL_BUTTON_POINT:"mapbox-gl-draw_point",CONTROL_BUTTON_TRASH:"mapbox-gl-draw_trash",CONTROL_BUTTON_COMBINE_FEATURES:"mapbox-gl-draw_combine",CONTROL_BUTTON_UNCOMBINE_FEATURES:"mapbox-gl-draw_uncombine",CONTROL_GROUP:"mapboxgl-ctrl-group",ATTRIBUTION:"mapboxgl-ctrl-attrib",ACTIVE_BUTTON:"active",BOX_SELECT:"mapbox-gl-draw_boxselect"},l={HOT:"mapbox-gl-draw-hot",COLD:"mapbox-gl-draw-cold"},p={ADD:"add",MOVE:"move",DRAG:"drag",POINTER:"pointer",NONE:"none"},h={POLYGON:"polygon",LINE:"line_string",POINT:"point"},f={FEATURE:"Feature",POLYGON:"Polygon",LINE_STRING:"LineString",POINT:"Point",FEATURE_COLLECTION:"FeatureCollection",MULTI_PREFIX:"Multi",MULTI_POINT:"MultiPoint",MULTI_LINE_STRING:"MultiLineString",MULTI_POLYGON:"MultiPolygon"},d={DRAW_LINE_STRING:"draw_line_string",DRAW_POLYGON:"draw_polygon",DRAW_POINT:"draw_point",SIMPLE_SELECT:"simple_select",DIRECT_SELECT:"direct_select",STATIC:"static"},g={CREATE:"draw.create",DELETE:"draw.delete",UPDATE:"draw.update",SELECTION_CHANGE:"draw.selectionchange",MODE_CHANGE:"draw.modechange",ACTIONABLE:"draw.actionable",RENDER:"draw.render",COMBINE_FEATURES:"draw.combine",UNCOMBINE_FEATURES:"draw.uncombine"},y={MOVE:"move",CHANGE_COORDINATES:"change_coordinates"},m={FEATURE:"feature",MIDPOINT:"midpoint",VERTEX:"vertex"},v={ACTIVE:"true",INACTIVE:"false"},b=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate"],E=-85,_=Object.freeze({__proto__:null,classes:c,sources:l,cursors:p,types:h,geojsonTypes:f,modes:d,events:g,updateActions:y,meta:m,activeStates:v,interactions:b,LAT_MIN:-90,LAT_RENDERED_MIN:E,LAT_MAX:90,LAT_RENDERED_MAX:85,LNG_MIN:-270,LNG_MAX:270}),x={Point:0,LineString:1,MultiLineString:1,Polygon:2};function S(t,e){var n=x[t.geometry.type]-x[e.geometry.type];return 0===n&&t.geometry.type===f.POLYGON?t.area-e.area:n}function w(t){return t.map((function(t){return t.geometry.type===f.POLYGON&&(t.area=o.geometry({type:f.FEATURE,property:{},geometry:t.geometry})),t})).sort(S).map((function(t){return delete t.area,t}))}function I(t,e){return void 0===e&&(e=0),[[t.point.x-e,t.point.y-e],[t.point.x+e,t.point.y+e]]}function O(t){if(this._items={},this._nums={},this._length=t?t.length:0,t)for(var e=0,n=t.length;e<n;e++)this.add(t[e]),void 0!==t[e]&&("string"==typeof t[e]?this._items[t[e]]=e:this._nums[t[e]]=e)}O.prototype.add=function(t){return this.has(t)||(this._length++,"string"==typeof t?this._items[t]=this._length:this._nums[t]=this._length),this},O.prototype.delete=function(t){return!1===this.has(t)||(this._length--,delete this._items[t],delete this._nums[t]),this},O.prototype.has=function(t){return!("string"!=typeof t&&"number"!=typeof t||void 0===this._items[t]&&void 0===this._nums[t])},O.prototype.values=function(){var t=this,e=[];return Object.keys(this._items).forEach((function(n){e.push({k:n,v:t._items[n]})})),Object.keys(this._nums).forEach((function(n){e.push({k:JSON.parse(n),v:t._nums[n]})})),e.sort((function(t,e){return t.v-e.v})).map((function(t){return t.k}))},O.prototype.clear=function(){return this._length=0,this._items={},this._nums={},this};var C=[m.FEATURE,m.MIDPOINT,m.VERTEX],T={click:function(t,e,n){return P(t,e,n,n.options.clickBuffer)},touch:function(t,e,n){return P(t,e,n,n.options.touchBuffer)}};function P(t,e,n,r){if(null===n.map)return[];var o=t?I(t,r):e,i={};n.options.styles&&(i.layers=n.options.styles.map((function(t){return t.id})).filter((function(t){return null!=n.map.getLayer(t)})));var s=n.map.queryRenderedFeatures(o,i).filter((function(t){return-1!==C.indexOf(t.properties.meta)})),a=new O,u=[];return s.forEach((function(t){var e=t.properties.id;a.has(e)||(a.add(e),u.push(t))})),w(u)}function M(t,e){var n=T.click(t,null,e),r={mouse:p.NONE};return n[0]&&(r.mouse=n[0].properties.active===v.ACTIVE?p.MOVE:p.POINTER,r.feature=n[0].properties.meta),-1!==e.events.currentModeName().indexOf("draw")&&(r.mouse=p.ADD),e.ui.queueMapClasses(r),e.ui.updateMapClasses(),n[0]}function L(t,e){var n=t.x-e.x,r=t.y-e.y;return Math.sqrt(n*n+r*r)}function A(t,e,n){void 0===n&&(n={});var r=null!=n.fineTolerance?n.fineTolerance:4,o=null!=n.grossTolerance?n.grossTolerance:12,i=null!=n.interval?n.interval:500;t.point=t.point||e.point,t.time=t.time||e.time;var s=L(t.point,e.point);return s<r||s<o&&e.time-t.time<i}function N(t,e,n){void 0===n&&(n={});var r=null!=n.tolerance?n.tolerance:25,o=null!=n.interval?n.interval:250;return t.point=t.point||e.point,t.time=t.time||e.time,L(t.point,e.point)<r&&e.time-t.time<o}var F={exports:{}},R=F.exports=function(t,e){if(e||(e=16),void 0===t&&(t=128),t<=0)return"0";for(var n=Math.log(Math.pow(2,t))/Math.log(e),r=2;n===1/0;r*=2)n=Math.log(Math.pow(2,t/r))/Math.log(e)*r;var o=n-Math.floor(n),i="";for(r=0;r<Math.floor(n);r++)i=Math.floor(Math.random()*e).toString(e)+i;if(o){var s=Math.pow(e,o);i=Math.floor(Math.random()*s).toString(e)+i}var a=parseInt(i,e);return a!==1/0&&a>=Math.pow(2,t)?R(t,e):i};R.rack=function(t,e,n){var r=function(r){var i=0;do{if(i++>10){if(!n)throw new Error("too many ID collisions, use more bits");t+=n}var s=R(t,e)}while(Object.hasOwnProperty.call(o,s));return o[s]=r,s},o=r.hats={};return r.get=function(t){return r.hats[t]},r.set=function(t,e){return r.hats[t]=e,r},r.bits=t||128,r.base=e||16,r};var k=e(F.exports),D=function(t,e){this.ctx=t,this.properties=e.properties||{},this.coordinates=e.geometry.coordinates,this.id=e.id||k(),this.type=e.geometry.type};D.prototype.changed=function(){this.ctx.store.featureChanged(this.id)},D.prototype.incomingCoords=function(t){this.setCoordinates(t)},D.prototype.setCoordinates=function(t){this.coordinates=t,this.changed()},D.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.coordinates))},D.prototype.setProperty=function(t,e){this.properties[t]=e},D.prototype.toGeoJSON=function(){return JSON.parse(JSON.stringify({id:this.id,type:f.FEATURE,properties:this.properties,geometry:{coordinates:this.getCoordinates(),type:this.type}}))},D.prototype.internal=function(t){var e={id:this.id,meta:m.FEATURE,"meta:type":this.type,active:v.INACTIVE,mode:t};if(this.ctx.options.userProperties)for(var n in this.properties)e["user_"+n]=this.properties[n];return{type:f.FEATURE,properties:e,geometry:{coordinates:this.getCoordinates(),type:this.type}}};var U=function(t,e){D.call(this,t,e)};(U.prototype=Object.create(D.prototype)).isValid=function(){return"number"==typeof this.coordinates[0]&&"number"==typeof this.coordinates[1]},U.prototype.updateCoordinate=function(t,e,n){this.coordinates=3===arguments.length?[e,n]:[t,e],this.changed()},U.prototype.getCoordinate=function(){return this.getCoordinates()};var j=function(t,e){D.call(this,t,e)};(j.prototype=Object.create(D.prototype)).isValid=function(){return this.coordinates.length>1},j.prototype.addCoordinate=function(t,e,n){this.changed();var r=parseInt(t,10);this.coordinates.splice(r,0,[e,n])},j.prototype.getCoordinate=function(t){var e=parseInt(t,10);return JSON.parse(JSON.stringify(this.coordinates[e]))},j.prototype.removeCoordinate=function(t){this.changed(),this.coordinates.splice(parseInt(t,10),1)},j.prototype.updateCoordinate=function(t,e,n){var r=parseInt(t,10);this.coordinates[r]=[e,n],this.changed()};var G=function(t,e){D.call(this,t,e),this.coordinates=this.coordinates.map((function(t){return t.slice(0,-1)}))};(G.prototype=Object.create(D.prototype)).isValid=function(){return 0!==this.coordinates.length&&this.coordinates.every((function(t){return t.length>2}))},G.prototype.incomingCoords=function(t){this.coordinates=t.map((function(t){return t.slice(0,-1)})),this.changed()},G.prototype.setCoordinates=function(t){this.coordinates=t,this.changed()},G.prototype.addCoordinate=function(t,e,n){this.changed();var r=t.split(".").map((function(t){return parseInt(t,10)}));this.coordinates[r[0]].splice(r[1],0,[e,n])},G.prototype.removeCoordinate=function(t){this.changed();var e=t.split(".").map((function(t){return parseInt(t,10)})),n=this.coordinates[e[0]];n&&(n.splice(e[1],1),n.length<3&&this.coordinates.splice(e[0],1))},G.prototype.getCoordinate=function(t){var e=t.split(".").map((function(t){return parseInt(t,10)})),n=this.coordinates[e[0]];return JSON.parse(JSON.stringify(n[e[1]]))},G.prototype.getCoordinates=function(){return this.coordinates.map((function(t){return t.concat([t[0]])}))},G.prototype.updateCoordinate=function(t,e,n){this.changed();var r=t.split("."),o=parseInt(r[0],10),i=parseInt(r[1],10);void 0===this.coordinates[o]&&(this.coordinates[o]=[]),this.coordinates[o][i]=[e,n]};var V={MultiPoint:U,MultiLineString:j,MultiPolygon:G},B=function(t,e,n,r,o){var i=n.split("."),s=parseInt(i[0],10),a=i[1]?i.slice(1).join("."):null;return t[s][e](a,r,o)},z=function(t,e){if(D.call(this,t,e),delete this.coordinates,this.model=V[e.geometry.type],void 0===this.model)throw new TypeError(e.geometry.type+" is not a valid type");this.features=this._coordinatesToFeatures(e.geometry.coordinates)};function $(t){this.map=t.map,this.drawConfig=JSON.parse(JSON.stringify(t.options||{})),this._ctx=t}(z.prototype=Object.create(D.prototype))._coordinatesToFeatures=function(t){var e=this,n=this.model.bind(this);return t.map((function(t){return new n(e.ctx,{id:k(),type:f.FEATURE,properties:{},geometry:{coordinates:t,type:e.type.replace("Multi","")}})}))},z.prototype.isValid=function(){return this.features.every((function(t){return t.isValid()}))},z.prototype.setCoordinates=function(t){this.features=this._coordinatesToFeatures(t),this.changed()},z.prototype.getCoordinate=function(t){return B(this.features,"getCoordinate",t)},z.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.features.map((function(t){return t.type===f.POLYGON?t.getCoordinates():t.coordinates}))))},z.prototype.updateCoordinate=function(t,e,n){B(this.features,"updateCoordinate",t,e,n),this.changed()},z.prototype.addCoordinate=function(t,e,n){B(this.features,"addCoordinate",t,e,n),this.changed()},z.prototype.removeCoordinate=function(t){B(this.features,"removeCoordinate",t),this.changed()},z.prototype.getFeatures=function(){return this.features},$.prototype.setSelected=function(t){return this._ctx.store.setSelected(t)},$.prototype.setSelectedCoordinates=function(t){var e=this;this._ctx.store.setSelectedCoordinates(t),t.reduce((function(t,n){return void 0===t[n.feature_id]&&(t[n.feature_id]=!0,e._ctx.store.get(n.feature_id).changed()),t}),{})},$.prototype.getSelected=function(){return this._ctx.store.getSelected()},$.prototype.getSelectedIds=function(){return this._ctx.store.getSelectedIds()},$.prototype.isSelected=function(t){return this._ctx.store.isSelected(t)},$.prototype.getFeature=function(t){return this._ctx.store.get(t)},$.prototype.select=function(t){return this._ctx.store.select(t)},$.prototype.deselect=function(t){return this._ctx.store.deselect(t)},$.prototype.deleteFeature=function(t,e){return void 0===e&&(e={}),this._ctx.store.delete(t,e)},$.prototype.addFeature=function(t){return this._ctx.store.add(t)},$.prototype.clearSelectedFeatures=function(){return this._ctx.store.clearSelected()},$.prototype.clearSelectedCoordinates=function(){return this._ctx.store.clearSelectedCoordinates()},$.prototype.setActionableState=function(t){void 0===t&&(t={});var e={trash:t.trash||!1,combineFeatures:t.combineFeatures||!1,uncombineFeatures:t.uncombineFeatures||!1};return this._ctx.events.actionable(e)},$.prototype.changeMode=function(t,e,n){return void 0===e&&(e={}),void 0===n&&(n={}),this._ctx.events.changeMode(t,e,n)},$.prototype.updateUIClasses=function(t){return this._ctx.ui.queueMapClasses(t)},$.prototype.activateUIButton=function(t){return this._ctx.ui.setActiveButton(t)},$.prototype.featuresAt=function(t,e,n){if(void 0===n&&(n="click"),"click"!==n&&"touch"!==n)throw new Error("invalid buffer type");return T[n](t,e,this._ctx)},$.prototype.newFeature=function(t){var e=t.geometry.type;return e===f.POINT?new U(this._ctx,t):e===f.LINE_STRING?new j(this._ctx,t):e===f.POLYGON?new G(this._ctx,t):new z(this._ctx,t)},$.prototype.isInstanceOf=function(t,e){if(t===f.POINT)return e instanceof U;if(t===f.LINE_STRING)return e instanceof j;if(t===f.POLYGON)return e instanceof G;if("MultiFeature"===t)return e instanceof z;throw new Error("Unknown feature class: "+t)},$.prototype.doRender=function(t){return this._ctx.store.featureChanged(t)},$.prototype.onSetup=function(){},$.prototype.onDrag=function(){},$.prototype.onClick=function(){},$.prototype.onMouseMove=function(){},$.prototype.onMouseDown=function(){},$.prototype.onMouseUp=function(){},$.prototype.onMouseOut=function(){},$.prototype.onKeyUp=function(){},$.prototype.onKeyDown=function(){},$.prototype.onTouchStart=function(){},$.prototype.onTouchMove=function(){},$.prototype.onTouchEnd=function(){},$.prototype.onTap=function(){},$.prototype.onStop=function(){},$.prototype.onTrash=function(){},$.prototype.onCombineFeature=function(){},$.prototype.onUncombineFeature=function(){},$.prototype.toDisplayFeatures=function(){throw new Error("You must overwrite toDisplayFeatures")};var J={drag:"onDrag",click:"onClick",mousemove:"onMouseMove",mousedown:"onMouseDown",mouseup:"onMouseUp",mouseout:"onMouseOut",keyup:"onKeyUp",keydown:"onKeyDown",touchstart:"onTouchStart",touchmove:"onTouchMove",touchend:"onTouchEnd",tap:"onTap"},q=Object.keys(J);function Y(t){var e=Object.keys(t);return function(n,r){void 0===r&&(r={});var o={},i=e.reduce((function(e,n){return e[n]=t[n],e}),new $(n));return{start:function(){var e=this;o=i.onSetup(r),q.forEach((function(n){var r,s=J[n],a=function(){return!1};t[s]&&(a=function(){return!0}),e.on(n,a,(r=s,function(t){return i[r](o,t)}))}))},stop:function(){i.onStop(o)},trash:function(){i.onTrash(o)},combineFeatures:function(){i.onCombineFeatures(o)},uncombineFeatures:function(){i.onUncombineFeatures(o)},render:function(t,e){i.toDisplayFeatures(o,t,e)}}}}function H(t){return[].concat(t).filter((function(t){return void 0!==t}))}function Z(){var t=this;if(!t.ctx.map||void 0===t.ctx.map.getSource(l.HOT))return u();var e=t.ctx.events.currentModeName();t.ctx.ui.queueMapClasses({mode:e});var n=[],r=[];t.isDirty?r=t.getAllIds():(n=t.getChangedIds().filter((function(e){return void 0!==t.get(e)})),r=t.sources.hot.filter((function(e){return e.properties.id&&-1===n.indexOf(e.properties.id)&&void 0!==t.get(e.properties.id)})).map((function(t){return t.properties.id}))),t.sources.hot=[];var o=t.sources.cold.length;t.sources.cold=t.isDirty?[]:t.sources.cold.filter((function(t){var e=t.properties.id||t.properties.parent;return-1===n.indexOf(e)}));var i=o!==t.sources.cold.length||r.length>0;function s(n,r){var o=t.get(n).internal(e);t.ctx.events.currentModeRender(o,(function(e){t.sources[r].push(e)}))}if(n.forEach((function(t){return s(t,"hot")})),r.forEach((function(t){return s(t,"cold")})),i&&t.ctx.map.getSource(l.COLD).setData({type:f.FEATURE_COLLECTION,features:t.sources.cold}),t.ctx.map.getSource(l.HOT).setData({type:f.FEATURE_COLLECTION,features:t.sources.hot}),t._emitSelectionChange&&(t.ctx.map.fire(g.SELECTION_CHANGE,{features:t.getSelected().map((function(t){return t.toGeoJSON()})),points:t.getSelectedCoordinates().map((function(t){return{type:f.FEATURE,properties:{},geometry:{type:f.POINT,coordinates:t.coordinates}}}))}),t._emitSelectionChange=!1),t._deletedFeaturesToEmit.length){var a=t._deletedFeaturesToEmit.map((function(t){return t.toGeoJSON()}));t._deletedFeaturesToEmit=[],t.ctx.map.fire(g.DELETE,{features:a})}function u(){t.isDirty=!1,t.clearChangedIds()}u(),t.ctx.map.fire(g.RENDER,{})}function X(t){var e,n=this;this._features={},this._featureIds=new O,this._selectedFeatureIds=new O,this._selectedCoordinates=[],this._changedFeatureIds=new O,this._deletedFeaturesToEmit=[],this._emitSelectionChange=!1,this._mapInitialConfig={},this.ctx=t,this.sources={hot:[],cold:[]},this.render=function(){e||(e=requestAnimationFrame((function(){e=null,Z.call(n)})))},this.isDirty=!1}function W(t,e){var n=t._selectedCoordinates.filter((function(e){return t._selectedFeatureIds.has(e.feature_id)}));t._selectedCoordinates.length===n.length||e.silent||(t._emitSelectionChange=!0),t._selectedCoordinates=n}X.prototype.createRenderBatch=function(){var t=this,e=this.render,n=0;return this.render=function(){n++},function(){t.render=e,n>0&&t.render()}},X.prototype.setDirty=function(){return this.isDirty=!0,this},X.prototype.featureChanged=function(t){return this._changedFeatureIds.add(t),this},X.prototype.getChangedIds=function(){return this._changedFeatureIds.values()},X.prototype.clearChangedIds=function(){return this._changedFeatureIds.clear(),this},X.prototype.getAllIds=function(){return this._featureIds.values()},X.prototype.add=function(t){return this.featureChanged(t.id),this._features[t.id]=t,this._featureIds.add(t.id),this},X.prototype.delete=function(t,e){var n=this;return void 0===e&&(e={}),H(t).forEach((function(t){n._featureIds.has(t)&&(n._featureIds.delete(t),n._selectedFeatureIds.delete(t),e.silent||-1===n._deletedFeaturesToEmit.indexOf(n._features[t])&&n._deletedFeaturesToEmit.push(n._features[t]),delete n._features[t],n.isDirty=!0)})),W(this,e),this},X.prototype.get=function(t){return this._features[t]},X.prototype.getAll=function(){var t=this;return Object.keys(this._features).map((function(e){return t._features[e]}))},X.prototype.select=function(t,e){var n=this;return void 0===e&&(e={}),H(t).forEach((function(t){n._selectedFeatureIds.has(t)||(n._selectedFeatureIds.add(t),n._changedFeatureIds.add(t),e.silent||(n._emitSelectionChange=!0))})),this},X.prototype.deselect=function(t,e){var n=this;return void 0===e&&(e={}),H(t).forEach((function(t){n._selectedFeatureIds.has(t)&&(n._selectedFeatureIds.delete(t),n._changedFeatureIds.add(t),e.silent||(n._emitSelectionChange=!0))})),W(this,e),this},X.prototype.clearSelected=function(t){return void 0===t&&(t={}),this.deselect(this._selectedFeatureIds.values(),{silent:t.silent}),this},X.prototype.setSelected=function(t,e){var n=this;return void 0===e&&(e={}),t=H(t),this.deselect(this._selectedFeatureIds.values().filter((function(e){return-1===t.indexOf(e)})),{silent:e.silent}),this.select(t.filter((function(t){return!n._selectedFeatureIds.has(t)})),{silent:e.silent}),this},X.prototype.setSelectedCoordinates=function(t){return this._selectedCoordinates=t,this._emitSelectionChange=!0,this},X.prototype.clearSelectedCoordinates=function(){return this._selectedCoordinates=[],this._emitSelectionChange=!0,this},X.prototype.getSelectedIds=function(){return this._selectedFeatureIds.values()},X.prototype.getSelected=function(){var t=this;return this._selectedFeatureIds.values().map((function(e){return t.get(e)}))},X.prototype.getSelectedCoordinates=function(){var t=this;return this._selectedCoordinates.map((function(e){return{coordinates:t.get(e.feature_id).getCoordinate(e.coord_path)}}))},X.prototype.isSelected=function(t){return this._selectedFeatureIds.has(t)},X.prototype.setFeatureProperty=function(t,e,n){this.get(t).setProperty(e,n),this.featureChanged(t)},X.prototype.storeMapConfig=function(){var t=this;b.forEach((function(e){t.ctx.map[e]&&(t._mapInitialConfig[e]=t.ctx.map[e].isEnabled())}))},X.prototype.restoreMapConfig=function(){var t=this;Object.keys(this._mapInitialConfig).forEach((function(e){t._mapInitialConfig[e]?t.ctx.map[e].enable():t.ctx.map[e].disable()}))},X.prototype.getInitialConfigValue=function(t){return void 0===this._mapInitialConfig[t]||this._mapInitialConfig[t]};var K=function(){for(var t=arguments,e={},n=0;n<arguments.length;n++){var r=t[n];for(var o in r)Q.call(r,o)&&(e[o]=r[o])}return e},Q=Object.prototype.hasOwnProperty,tt=e(K),et=["mode","feature","mouse"];function nt(e){var n=null,r=null,o={onRemove:function(){return e.map.off("load",o.connect),clearInterval(r),o.removeLayers(),e.store.restoreMapConfig(),e.ui.removeButtons(),e.events.removeEventListeners(),e.ui.clearMapClasses(),e.boxZoomInitial&&e.map.boxZoom.enable(),e.map=null,e.container=null,e.store=null,n&&n.parentNode&&n.parentNode.removeChild(n),n=null,this},connect:function(){e.map.off("load",o.connect),clearInterval(r),o.addLayers(),e.store.storeMapConfig(),e.events.addEventListeners()},onAdd:function(i){var s=i.fire;return i.fire=function(t,e){var n=arguments;return 1===s.length&&1!==arguments.length&&(n=[tt({},{type:t},e)]),s.apply(i,n)},e.map=i,e.events=function(e){var n=Object.keys(e.options.modes).reduce((function(t,n){return t[n]=Y(e.options.modes[n]),t}),{}),r={},o={},i={},s=null,a=null;i.drag=function(t,n){n({point:t.point,time:(new Date).getTime()})?(e.ui.queueMapClasses({mouse:p.DRAG}),a.drag(t)):t.originalEvent.stopPropagation()},i.mousedrag=function(t){i.drag(t,(function(t){return!A(r,t)}))},i.touchdrag=function(t){i.drag(t,(function(t){return!N(o,t)}))},i.mousemove=function(t){if(1===(void 0!==t.originalEvent.buttons?t.originalEvent.buttons:t.originalEvent.which))return i.mousedrag(t);var n=M(t,e);t.featureTarget=n,a.mousemove(t)},i.mousedown=function(t){r={time:(new Date).getTime(),point:t.point};var n=M(t,e);t.featureTarget=n,a.mousedown(t)},i.mouseup=function(t){var n=M(t,e);t.featureTarget=n,A(r,{point:t.point,time:(new Date).getTime()})?a.click(t):a.mouseup(t)},i.mouseout=function(t){a.mouseout(t)},i.touchstart=function(t){if(e.options.touchEnabled){o={time:(new Date).getTime(),point:t.point};var n=T.touch(t,null,e)[0];t.featureTarget=n,a.touchstart(t)}},i.touchmove=function(t){if(e.options.touchEnabled)return a.touchmove(t),i.touchdrag(t)},i.touchend=function(t){if(t.originalEvent.preventDefault(),e.options.touchEnabled){var n=T.touch(t,null,e)[0];t.featureTarget=n,N(o,{time:(new Date).getTime(),point:t.point})?a.tap(t):a.touchend(t)}};var u=function(t){return!(8===t||46===t||t>=48&&t<=57)};function c(r,o,i){void 0===i&&(i={}),a.stop();var u=n[r];if(void 0===u)throw new Error(r+" is not valid");s=r;var c=u(e,o);a=t(c,e),i.silent||e.map.fire(g.MODE_CHANGE,{mode:r}),e.store.setDirty(),e.store.render()}i.keydown=function(t){(t.srcElement||t.target).classList.contains("mapboxgl-canvas")&&(8!==t.keyCode&&46!==t.keyCode||!e.options.controls.trash?u(t.keyCode)?a.keydown(t):49===t.keyCode&&e.options.controls.point?c(d.DRAW_POINT):50===t.keyCode&&e.options.controls.line_string?c(d.DRAW_LINE_STRING):51===t.keyCode&&e.options.controls.polygon&&c(d.DRAW_POLYGON):(t.preventDefault(),a.trash()))},i.keyup=function(t){u(t.keyCode)&&a.keyup(t)},i.zoomend=function(){e.store.changeZoom()},i.data=function(t){if("style"===t.dataType){var n=e.setup,r=e.map,o=e.options,i=e.store;o.styles.some((function(t){return r.getLayer(t.id)}))||(n.addLayers(),i.setDirty(),i.render())}};var l={trash:!1,combineFeatures:!1,uncombineFeatures:!1};return{start:function(){s=e.options.defaultMode,a=t(n[s](e),e)},changeMode:c,actionable:function(t){var n=!1;Object.keys(t).forEach((function(e){if(void 0===l[e])throw new Error("Invalid action type");l[e]!==t[e]&&(n=!0),l[e]=t[e]})),n&&e.map.fire(g.ACTIONABLE,{actions:l})},currentModeName:function(){return s},currentModeRender:function(t,e){return a.render(t,e)},fire:function(t,e){i[t]&&i[t](e)},addEventListeners:function(){e.map.on("mousemove",i.mousemove),e.map.on("mousedown",i.mousedown),e.map.on("mouseup",i.mouseup),e.map.on("data",i.data),e.map.on("touchmove",i.touchmove),e.map.on("touchstart",i.touchstart),e.map.on("touchend",i.touchend),e.container.addEventListener("mouseout",i.mouseout),e.options.keybindings&&(e.container.addEventListener("keydown",i.keydown),e.container.addEventListener("keyup",i.keyup))},removeEventListeners:function(){e.map.off("mousemove",i.mousemove),e.map.off("mousedown",i.mousedown),e.map.off("mouseup",i.mouseup),e.map.off("data",i.data),e.map.off("touchmove",i.touchmove),e.map.off("touchstart",i.touchstart),e.map.off("touchend",i.touchend),e.container.removeEventListener("mouseout",i.mouseout),e.options.keybindings&&(e.container.removeEventListener("keydown",i.keydown),e.container.removeEventListener("keyup",i.keyup))},trash:function(t){a.trash(t)},combineFeatures:function(){a.combineFeatures()},uncombineFeatures:function(){a.uncombineFeatures()},getMode:function(){return s}}}(e),e.ui=function(t){var e={},n=null,r={mode:null,feature:null,mouse:null},o={mode:null,feature:null,mouse:null};function i(t){o=tt(o,t)}function s(){var e,n;if(t.container){var i=[],s=[];et.forEach((function(t){o[t]!==r[t]&&(i.push(t+"-"+r[t]),null!==o[t]&&s.push(t+"-"+o[t]))})),i.length>0&&(e=t.container.classList).remove.apply(e,i),s.length>0&&(n=t.container.classList).add.apply(n,s),r=tt(r,o)}}function a(t,e){void 0===e&&(e={});var r=document.createElement("button");return r.className=c.CONTROL_BUTTON+" "+e.className,r.setAttribute("title",e.title),e.container.appendChild(r),r.addEventListener("click",(function(r){if(r.preventDefault(),r.stopPropagation(),r.target===n)return u(),void e.onDeactivate();l(t),e.onActivate()}),!0),r}function u(){n&&(n.classList.remove(c.ACTIVE_BUTTON),n=null)}function l(t){u();var r=e[t];r&&r&&"trash"!==t&&(r.classList.add(c.ACTIVE_BUTTON),n=r)}return{setActiveButton:l,queueMapClasses:i,updateMapClasses:s,clearMapClasses:function(){i({mode:null,feature:null,mouse:null}),s()},addButtons:function(){var n=t.options.controls,r=document.createElement("div");return r.className=c.CONTROL_GROUP+" "+c.CONTROL_BASE,n?(n[h.LINE]&&(e[h.LINE]=a(h.LINE,{container:r,className:c.CONTROL_BUTTON_LINE,title:"LineString tool "+(t.options.keybindings?"(l)":""),onActivate:function(){return t.events.changeMode(d.DRAW_LINE_STRING)},onDeactivate:function(){return t.events.trash()}})),n[h.POLYGON]&&(e[h.POLYGON]=a(h.POLYGON,{container:r,className:c.CONTROL_BUTTON_POLYGON,title:"Polygon tool "+(t.options.keybindings?"(p)":""),onActivate:function(){return t.events.changeMode(d.DRAW_POLYGON)},onDeactivate:function(){return t.events.trash()}})),n[h.POINT]&&(e[h.POINT]=a(h.POINT,{container:r,className:c.CONTROL_BUTTON_POINT,title:"Marker tool "+(t.options.keybindings?"(m)":""),onActivate:function(){return t.events.changeMode(d.DRAW_POINT)},onDeactivate:function(){return t.events.trash()}})),n.trash&&(e.trash=a("trash",{container:r,className:c.CONTROL_BUTTON_TRASH,title:"Delete",onActivate:function(){t.events.trash()}})),n.combine_features&&(e.combine_features=a("combineFeatures",{container:r,className:c.CONTROL_BUTTON_COMBINE_FEATURES,title:"Combine",onActivate:function(){t.events.combineFeatures()}})),n.uncombine_features&&(e.uncombine_features=a("uncombineFeatures",{container:r,className:c.CONTROL_BUTTON_UNCOMBINE_FEATURES,title:"Uncombine",onActivate:function(){t.events.uncombineFeatures()}})),r):r},removeButtons:function(){Object.keys(e).forEach((function(t){var n=e[t];n.parentNode&&n.parentNode.removeChild(n),delete e[t]}))}}}(e),e.container=i.getContainer(),e.store=new X(e),n=e.ui.addButtons(),e.options.boxSelect&&(e.boxZoomInitial=i.boxZoom.isEnabled(),i.boxZoom.disable(),i.dragPan.disable(),i.dragPan.enable()),i.loaded()?o.connect():(i.on("load",o.connect),r=setInterval((function(){i.loaded()&&o.connect()}),16)),e.events.start(),n},addLayers:function(){e.map.addSource(l.COLD,{data:{type:f.FEATURE_COLLECTION,features:[]},type:"geojson"}),e.map.addSource(l.HOT,{data:{type:f.FEATURE_COLLECTION,features:[]},type:"geojson"}),e.options.styles.forEach((function(t){e.map.addLayer(t)})),e.store.setDirty(!0),e.store.render()},removeLayers:function(){e.options.styles.forEach((function(t){e.map.getLayer(t.id)&&e.map.removeLayer(t.id)})),e.map.getSource(l.COLD)&&e.map.removeSource(l.COLD),e.map.getSource(l.HOT)&&e.map.removeSource(l.HOT)}};return e.setup=o,o}var rt=[{id:"gl-draw-polygon-fill-inactive",type:"fill",filter:["all",["==","active","false"],["==","$type","Polygon"],["!=","mode","static"]],paint:{"fill-color":"#3bb2d0","fill-outline-color":"#3bb2d0","fill-opacity":.1}},{id:"gl-draw-polygon-fill-active",type:"fill",filter:["all",["==","active","true"],["==","$type","Polygon"]],paint:{"fill-color":"#fbb03b","fill-outline-color":"#fbb03b","fill-opacity":.1}},{id:"gl-draw-polygon-midpoint",type:"circle",filter:["all",["==","$type","Point"],["==","meta","midpoint"]],paint:{"circle-radius":3,"circle-color":"#fbb03b"}},{id:"gl-draw-polygon-stroke-inactive",type:"line",filter:["all",["==","active","false"],["==","$type","Polygon"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#3bb2d0","line-width":2}},{id:"gl-draw-polygon-stroke-active",type:"line",filter:["all",["==","active","true"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#fbb03b","line-dasharray":[.2,2],"line-width":2}},{id:"gl-draw-line-inactive",type:"line",filter:["all",["==","active","false"],["==","$type","LineString"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#3bb2d0","line-width":2}},{id:"gl-draw-line-active",type:"line",filter:["all",["==","$type","LineString"],["==","active","true"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#fbb03b","line-dasharray":[.2,2],"line-width":2}},{id:"gl-draw-polygon-and-line-vertex-stroke-inactive",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":5,"circle-color":"#fff"}},{id:"gl-draw-polygon-and-line-vertex-inactive",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":3,"circle-color":"#fbb03b"}},{id:"gl-draw-point-point-stroke-inactive",type:"circle",filter:["all",["==","active","false"],["==","$type","Point"],["==","meta","feature"],["!=","mode","static"]],paint:{"circle-radius":5,"circle-opacity":1,"circle-color":"#fff"}},{id:"gl-draw-point-inactive",type:"circle",filter:["all",["==","active","false"],["==","$type","Point"],["==","meta","feature"],["!=","mode","static"]],paint:{"circle-radius":3,"circle-color":"#3bb2d0"}},{id:"gl-draw-point-stroke-active",type:"circle",filter:["all",["==","$type","Point"],["==","active","true"],["!=","meta","midpoint"]],paint:{"circle-radius":7,"circle-color":"#fff"}},{id:"gl-draw-point-active",type:"circle",filter:["all",["==","$type","Point"],["!=","meta","midpoint"],["==","active","true"]],paint:{"circle-radius":5,"circle-color":"#fbb03b"}},{id:"gl-draw-polygon-fill-static",type:"fill",filter:["all",["==","mode","static"],["==","$type","Polygon"]],paint:{"fill-color":"#404040","fill-outline-color":"#404040","fill-opacity":.1}},{id:"gl-draw-polygon-stroke-static",type:"line",filter:["all",["==","mode","static"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#404040","line-width":2}},{id:"gl-draw-line-static",type:"line",filter:["all",["==","mode","static"],["==","$type","LineString"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#404040","line-width":2}},{id:"gl-draw-point-static",type:"circle",filter:["all",["==","mode","static"],["==","$type","Point"]],paint:{"circle-radius":5,"circle-color":"#404040"}}];function ot(t){return function(e){var n=e.featureTarget;return!!n&&!!n.properties&&n.properties.meta===t}}function it(t){return!!t.originalEvent&&!!t.originalEvent.shiftKey&&0===t.originalEvent.button}function st(t){return!!t.featureTarget&&!!t.featureTarget.properties&&t.featureTarget.properties.active===v.ACTIVE&&t.featureTarget.properties.meta===m.FEATURE}function at(t){return!!t.featureTarget&&!!t.featureTarget.properties&&t.featureTarget.properties.active===v.INACTIVE&&t.featureTarget.properties.meta===m.FEATURE}function ut(t){return void 0===t.featureTarget}function ct(t){return!!t.featureTarget&&!!t.featureTarget.properties&&t.featureTarget.properties.meta===m.FEATURE}function lt(t){var e=t.featureTarget;return!!e&&!!e.properties&&e.properties.meta===m.VERTEX}function pt(t){return!!t.originalEvent&&!0===t.originalEvent.shiftKey}function ht(t){return 27===t.keyCode}function ft(t){return 13===t.keyCode}var dt=Object.freeze({__proto__:null,isOfMetaType:ot,isShiftMousedown:it,isActiveFeature:st,isInactiveFeature:at,noTarget:ut,isFeature:ct,isVertex:lt,isShiftDown:pt,isEscapeKey:ht,isEnterKey:ft,isTrue:function(){return!0}}),gt=yt;function yt(t,e){this.x=t,this.y=e}yt.prototype={clone:function(){return new yt(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,n=t.y-this.y;return e*e+n*n},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[0]*this.x+t[1]*this.y,n=t[2]*this.x+t[3]*this.y;return this.x=e,this.y=n,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),n=Math.sin(t),r=e*this.x-n*this.y,o=n*this.x+e*this.y;return this.x=r,this.y=o,this},_rotateAround:function(t,e){var n=Math.cos(t),r=Math.sin(t),o=e.x+n*(this.x-e.x)-r*(this.y-e.y),i=e.y+r*(this.x-e.x)+n*(this.y-e.y);return this.x=o,this.y=i,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},yt.convert=function(t){return t instanceof yt?t:Array.isArray(t)?new yt(t[0],t[1]):t};var mt=e(gt);function vt(t,e){var n=e.getBoundingClientRect();return new mt(t.clientX-n.left-(e.clientLeft||0),t.clientY-n.top-(e.clientTop||0))}function bt(t,e,n,r){return{type:f.FEATURE,properties:{meta:m.VERTEX,parent:t,coord_path:n,active:r?v.ACTIVE:v.INACTIVE},geometry:{type:f.POINT,coordinates:e}}}function Et(t,e,n){var r=e.geometry.coordinates,o=n.geometry.coordinates;if(r[1]>85||r[1]<E||o[1]>85||o[1]<E)return null;var i={lng:(r[0]+o[0])/2,lat:(r[1]+o[1])/2};return{type:f.FEATURE,properties:{meta:m.MIDPOINT,parent:t,lng:i.lng,lat:i.lat,coord_path:n.properties.coord_path},geometry:{type:f.POINT,coordinates:[i.lng,i.lat]}}}function _t(t,e,n){void 0===e&&(e={}),void 0===n&&(n=null);var r,o=t.geometry,i=o.type,s=o.coordinates,a=t.properties&&t.properties.id,u=[];function c(t,n){var r="",o=null;t.forEach((function(t,i){var s=null!=n?n+"."+i:String(i),c=bt(a,t,s,l(s));if(e.midpoints&&o){var p=Et(a,o,c);p&&u.push(p)}o=c;var h=JSON.stringify(t);r!==h&&u.push(c),0===i&&(r=h)}))}function l(t){return!!e.selectedPaths&&-1!==e.selectedPaths.indexOf(t)}return i===f.POINT?u.push(bt(a,s,n,l(n))):i===f.POLYGON?s.forEach((function(t,e){c(t,null!==n?n+"."+e:String(e))})):i===f.LINE_STRING?c(s,n):0===i.indexOf(f.MULTI_PREFIX)&&(r=i.replace(f.MULTI_PREFIX,""),s.forEach((function(n,o){var i={type:f.FEATURE,properties:t.properties,geometry:{type:r,coordinates:n}};u=u.concat(_t(i,e,o))}))),u}var xt={enable:function(t){setTimeout((function(){t.map&&t.map.doubleClickZoom&&t._ctx&&t._ctx.store&&t._ctx.store.getInitialConfigValue&&t._ctx.store.getInitialConfigValue("doubleClickZoom")&&t.map.doubleClickZoom.enable()}),0)},disable:function(t){setTimeout((function(){t.map&&t.map.doubleClickZoom&&t.map.doubleClickZoom.disable()}),0)}},St={exports:{}},wt=function(t){if(!t||!t.type)return null;var e=It[t.type];return e?"geometry"===e?{type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:t}]}:"feature"===e?{type:"FeatureCollection",features:[t]}:"featurecollection"===e?t:void 0:null},It={Point:"geometry",MultiPoint:"geometry",LineString:"geometry",MultiLineString:"geometry",Polygon:"geometry",MultiPolygon:"geometry",GeometryCollection:"geometry",Feature:"feature",FeatureCollection:"featurecollection"},Ot=e(wt),Ct=Object.freeze({__proto__:null,default:function t(e){switch(e&&e.type||null){case"FeatureCollection":return e.features=e.features.reduce((function(e,n){return e.concat(t(n))}),[]),e;case"Feature":return e.geometry?t(e.geometry).map((function(t){var n={type:"Feature",properties:JSON.parse(JSON.stringify(e.properties)),geometry:t};return void 0!==e.id&&(n.id=e.id),n})):[e];case"MultiPoint":return e.coordinates.map((function(t){return{type:"Point",coordinates:t}}));case"MultiPolygon":return e.coordinates.map((function(t){return{type:"Polygon",coordinates:t}}));case"MultiLineString":return e.coordinates.map((function(t){return{type:"LineString",coordinates:t}}));case"GeometryCollection":return e.geometries.map(t).reduce((function(t,e){return t.concat(e)}),[]);case"Point":case"Polygon":case"LineString":return[e]}}}),Tt=wt,Pt=r(Ct),Mt=function(t){return function t(e){return Array.isArray(e)&&e.length&&"number"==typeof e[0]?[e]:e.reduce((function(e,n){return Array.isArray(n)&&Array.isArray(n[0])?e.concat(t(n)):(e.push(n),e)}),[])}(t)};Pt instanceof Function||(Pt=Pt.default);var Lt={exports:{}},At=Lt.exports=function(t){return new Nt(t)};function Nt(t){this.value=t}function Ft(t,e,n){var r=[],o=[],i=!0;return function t(s){var a=n?Rt(s):s,u={},c=!0,l={node:a,node_:s,path:[].concat(r),parent:o[o.length-1],parents:o,key:r.slice(-1)[0],isRoot:0===r.length,level:r.length,circular:null,update:function(t,e){l.isRoot||(l.parent.node[l.key]=t),l.node=t,e&&(c=!1)},delete:function(t){delete l.parent.node[l.key],t&&(c=!1)},remove:function(t){Ut(l.parent.node)?l.parent.node.splice(l.key,1):delete l.parent.node[l.key],t&&(c=!1)},keys:null,before:function(t){u.before=t},after:function(t){u.after=t},pre:function(t){u.pre=t},post:function(t){u.post=t},stop:function(){i=!1},block:function(){c=!1}};if(!i)return l;function p(){if("object"==typeof l.node&&null!==l.node){l.keys&&l.node_===l.node||(l.keys=kt(l.node)),l.isLeaf=0==l.keys.length;for(var t=0;t<o.length;t++)if(o[t].node_===s){l.circular=o[t];break}}else l.isLeaf=!0,l.keys=null;l.notLeaf=!l.isLeaf,l.notRoot=!l.isRoot}p();var h=e.call(l,l.node);return void 0!==h&&l.update&&l.update(h),u.before&&u.before.call(l,l.node),c?("object"!=typeof l.node||null===l.node||l.circular||(o.push(l),p(),jt(l.keys,(function(e,o){r.push(e),u.pre&&u.pre.call(l,l.node[e],e);var i=t(l.node[e]);n&&Gt.call(l.node,e)&&(l.node[e]=i.node),i.isLast=o==l.keys.length-1,i.isFirst=0==o,u.post&&u.post.call(l,i),r.pop()})),o.pop()),u.after&&u.after.call(l,l.node),l):l}(t).node}function Rt(t){if("object"==typeof t&&null!==t){var e;if(Ut(t))e=[];else if("[object Date]"===Dt(t))e=new Date(t.getTime?t.getTime():t);else if(function(t){return"[object RegExp]"===Dt(t)}(t))e=new RegExp(t);else if(function(t){return"[object Error]"===Dt(t)}(t))e={message:t.message};else if(function(t){return"[object Boolean]"===Dt(t)}(t))e=new Boolean(t);else if(function(t){return"[object Number]"===Dt(t)}(t))e=new Number(t);else if(function(t){return"[object String]"===Dt(t)}(t))e=new String(t);else if(Object.create&&Object.getPrototypeOf)e=Object.create(Object.getPrototypeOf(t));else if(t.constructor===Object)e={};else{var n=t.constructor&&t.constructor.prototype||t.__proto__||{},r=function(){};r.prototype=n,e=new r}return jt(kt(t),(function(n){e[n]=t[n]})),e}return t}Nt.prototype.get=function(t){for(var e=this.value,n=0;n<t.length;n++){var r=t[n];if(!e||!Gt.call(e,r)){e=void 0;break}e=e[r]}return e},Nt.prototype.has=function(t){for(var e=this.value,n=0;n<t.length;n++){var r=t[n];if(!e||!Gt.call(e,r))return!1;e=e[r]}return!0},Nt.prototype.set=function(t,e){for(var n=this.value,r=0;r<t.length-1;r++){var o=t[r];Gt.call(n,o)||(n[o]={}),n=n[o]}return n[t[r]]=e,e},Nt.prototype.map=function(t){return Ft(this.value,t,!0)},Nt.prototype.forEach=function(t){return this.value=Ft(this.value,t,!1),this.value},Nt.prototype.reduce=function(t,e){var n=1===arguments.length,r=n?this.value:e;return this.forEach((function(e){this.isRoot&&n||(r=t.call(this,r,e))})),r},Nt.prototype.paths=function(){var t=[];return this.forEach((function(e){t.push(this.path)})),t},Nt.prototype.nodes=function(){var t=[];return this.forEach((function(e){t.push(this.node)})),t},Nt.prototype.clone=function(){var t=[],e=[];return function n(r){for(var o=0;o<t.length;o++)if(t[o]===r)return e[o];if("object"==typeof r&&null!==r){var i=Rt(r);return t.push(r),e.push(i),jt(kt(r),(function(t){i[t]=n(r[t])})),t.pop(),e.pop(),i}return r}(this.value)};var kt=Object.keys||function(t){var e=[];for(var n in t)e.push(n);return e};function Dt(t){return Object.prototype.toString.call(t)}var Ut=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)},jt=function(t,e){if(t.forEach)return t.forEach(e);for(var n=0;n<t.length;n++)e(t[n],n,t)};jt(kt(Nt.prototype),(function(t){At[t]=function(e){var n=[].slice.call(arguments,1),r=new Nt(e);return r[t].apply(r,n)}}));var Gt=Object.hasOwnProperty||function(t,e){return e in t},Vt=Lt.exports,Bt=zt;function zt(t){if(!(this instanceof zt))return new zt(t);this._bbox=t||[1/0,1/0,-1/0,-1/0],this._valid=!!t}zt.prototype.include=function(t){return this._valid=!0,this._bbox[0]=Math.min(this._bbox[0],t[0]),this._bbox[1]=Math.min(this._bbox[1],t[1]),this._bbox[2]=Math.max(this._bbox[2],t[0]),this._bbox[3]=Math.max(this._bbox[3],t[1]),this},zt.prototype.equals=function(t){var e;return e=t instanceof zt?t.bbox():t,this._bbox[0]==e[0]&&this._bbox[1]==e[1]&&this._bbox[2]==e[2]&&this._bbox[3]==e[3]},zt.prototype.center=function(t){return this._valid?[(this._bbox[0]+this._bbox[2])/2,(this._bbox[1]+this._bbox[3])/2]:null},zt.prototype.union=function(t){var e;return this._valid=!0,e=t instanceof zt?t.bbox():t,this._bbox[0]=Math.min(this._bbox[0],e[0]),this._bbox[1]=Math.min(this._bbox[1],e[1]),this._bbox[2]=Math.max(this._bbox[2],e[2]),this._bbox[3]=Math.max(this._bbox[3],e[3]),this},zt.prototype.bbox=function(){return this._valid?this._bbox:null},zt.prototype.contains=function(t){if(!t)return this._fastContains();if(!this._valid)return null;var e=t[0],n=t[1];return this._bbox[0]<=e&&this._bbox[1]<=n&&this._bbox[2]>=e&&this._bbox[3]>=n},zt.prototype.intersect=function(t){return this._valid?(e=t instanceof zt?t.bbox():t,!(this._bbox[0]>e[2]||this._bbox[2]<e[0]||this._bbox[3]<e[1]||this._bbox[1]>e[3])):null;var e},zt.prototype._fastContains=function(){if(!this._valid)return new Function("return null;");var t="return "+this._bbox[0]+"<= ll[0] &&"+this._bbox[1]+"<= ll[1] &&"+this._bbox[2]+">= ll[0] &&"+this._bbox[3]+">= ll[1]";return new Function("ll",t)},zt.prototype.polygon=function(){return this._valid?{type:"Polygon",coordinates:[[[this._bbox[0],this._bbox[1]],[this._bbox[2],this._bbox[1]],[this._bbox[2],this._bbox[3]],[this._bbox[0],this._bbox[3]],[this._bbox[0],this._bbox[1]]]]}:null};var $t=function(t){if(!t)return[];var e=Pt(Tt(t)),n=[];return e.features.forEach((function(t){t.geometry&&(n=n.concat(Mt(t.geometry.coordinates)))})),n},Jt=Vt,qt=Bt,Yt={features:["FeatureCollection"],coordinates:["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon"],geometry:["Feature"],geometries:["GeometryCollection"]},Ht=Object.keys(Yt);function Zt(t){for(var e=qt(),n=$t(t),r=0;r<n.length;r++)e.include(n[r]);return e}St.exports=function(t){return Zt(t).bbox()},St.exports.polygon=function(t){return Zt(t).polygon()},St.exports.bboxify=function(t){return Jt(t).map((function(t){t&&Ht.some((function(e){return!!t[e]&&-1!==Yt[e].indexOf(t.type)}))&&(t.bbox=Zt(t).bbox(),this.update(t))}))};var Xt=e(St.exports),Wt=-90;function Kt(t,e){var n=Wt,r=90,o=Wt,i=90,s=270,a=-270;t.forEach((function(t){var e=Xt(t),u=e[1],c=e[3],l=e[0],p=e[2];u>n&&(n=u),c<r&&(r=c),c>o&&(o=c),u<i&&(i=u),l<s&&(s=l),p>a&&(a=p)}));var u=e;return n+u.lat>85&&(u.lat=85-n),o+u.lat>90&&(u.lat=90-o),r+u.lat<-85&&(u.lat=-85-r),i+u.lat<Wt&&(u.lat=Wt-i),s+u.lng<=-270&&(u.lng+=360*Math.ceil(Math.abs(u.lng)/360)),a+u.lng>=270&&(u.lng-=360*Math.ceil(Math.abs(u.lng)/360)),u}function Qt(t,e){var n=Kt(t.map((function(t){return t.toGeoJSON()})),e);t.forEach((function(t){var e,r=t.getCoordinates(),o=function(t){var e={lng:t[0]+n.lng,lat:t[1]+n.lat};return[e.lng,e.lat]},i=function(t){return t.map((function(t){return o(t)}))};t.type===f.POINT?e=o(r):t.type===f.LINE_STRING||t.type===f.MULTI_POINT?e=r.map(o):t.type===f.POLYGON||t.type===f.MULTI_LINE_STRING?e=r.map(i):t.type===f.MULTI_POLYGON&&(e=r.map((function(t){return t.map((function(t){return i(t)}))}))),t.incomingCoords(e)}))}var te={onSetup:function(t){var e=this,n={dragMoveLocation:null,boxSelectStartLocation:null,boxSelectElement:void 0,boxSelecting:!1,canBoxSelect:!1,dragMoving:!1,canDragMove:!1,initiallySelectedFeatureIds:t.featureIds||[]};return this.setSelected(n.initiallySelectedFeatureIds.filter((function(t){return void 0!==e.getFeature(t)}))),this.fireActionable(),this.setActionableState({combineFeatures:!0,uncombineFeatures:!0,trash:!0}),n},fireUpdate:function(){this.map.fire(g.UPDATE,{action:y.MOVE,features:this.getSelected().map((function(t){return t.toGeoJSON()}))})},fireActionable:function(){var t=this,e=this.getSelected(),n=e.filter((function(e){return t.isInstanceOf("MultiFeature",e)})),r=!1;if(e.length>1){r=!0;var o=e[0].type.replace("Multi","");e.forEach((function(t){t.type.replace("Multi","")!==o&&(r=!1)}))}var i=n.length>0,s=e.length>0;this.setActionableState({combineFeatures:r,uncombineFeatures:i,trash:s})},getUniqueIds:function(t){return t.length?t.map((function(t){return t.properties.id})).filter((function(t){return void 0!==t})).reduce((function(t,e){return t.add(e),t}),new O).values():[]},stopExtendedInteractions:function(t){t.boxSelectElement&&(t.boxSelectElement.parentNode&&t.boxSelectElement.parentNode.removeChild(t.boxSelectElement),t.boxSelectElement=null),this.map.dragPan.enable(),t.boxSelecting=!1,t.canBoxSelect=!1,t.dragMoving=!1,t.canDragMove=!1},onStop:function(){xt.enable(this)},onMouseMove:function(t,e){return ct(e)&&t.dragMoving&&this.fireUpdate(),this.stopExtendedInteractions(t),!0},onMouseOut:function(t){return!t.dragMoving||this.fireUpdate()}};te.onTap=te.onClick=function(t,e){return ut(e)?this.clickAnywhere(t,e):ot(m.VERTEX)(e)?this.clickOnVertex(t,e):ct(e)?this.clickOnFeature(t,e):void 0},te.clickAnywhere=function(t){var e=this,n=this.getSelectedIds();n.length&&(this.clearSelectedFeatures(),n.forEach((function(t){return e.doRender(t)}))),xt.enable(this),this.stopExtendedInteractions(t)},te.clickOnVertex=function(t,e){this.changeMode(d.DIRECT_SELECT,{featureId:e.featureTarget.properties.parent,coordPath:e.featureTarget.properties.coord_path,startPos:e.lngLat}),this.updateUIClasses({mouse:p.MOVE})},te.startOnActiveFeature=function(t,e){this.stopExtendedInteractions(t),this.map.dragPan.disable(),this.doRender(e.featureTarget.properties.id),t.canDragMove=!0,t.dragMoveLocation=e.lngLat},te.clickOnFeature=function(t,e){var n=this;xt.disable(this),this.stopExtendedInteractions(t);var r=pt(e),o=this.getSelectedIds(),i=e.featureTarget.properties.id,s=this.isSelected(i);if(!r&&s&&this.getFeature(i).type!==f.POINT)return this.changeMode(d.DIRECT_SELECT,{featureId:i});s&&r?(this.deselect(i),this.updateUIClasses({mouse:p.POINTER}),1===o.length&&xt.enable(this)):!s&&r?(this.select(i),this.updateUIClasses({mouse:p.MOVE})):s||r||(o.forEach((function(t){return n.doRender(t)})),this.setSelected(i),this.updateUIClasses({mouse:p.MOVE})),this.doRender(i)},te.onMouseDown=function(t,e){return st(e)?this.startOnActiveFeature(t,e):this.drawConfig.boxSelect&&it(e)?this.startBoxSelect(t,e):void 0},te.startBoxSelect=function(t,e){this.stopExtendedInteractions(t),this.map.dragPan.disable(),t.boxSelectStartLocation=vt(e.originalEvent,this.map.getContainer()),t.canBoxSelect=!0},te.onTouchStart=function(t,e){if(st(e))return this.startOnActiveFeature(t,e)},te.onDrag=function(t,e){return t.canDragMove?this.dragMove(t,e):this.drawConfig.boxSelect&&t.canBoxSelect?this.whileBoxSelect(t,e):void 0},te.whileBoxSelect=function(t,e){t.boxSelecting=!0,this.updateUIClasses({mouse:p.ADD}),t.boxSelectElement||(t.boxSelectElement=document.createElement("div"),t.boxSelectElement.classList.add(c.BOX_SELECT),this.map.getContainer().appendChild(t.boxSelectElement));var n=vt(e.originalEvent,this.map.getContainer()),r=Math.min(t.boxSelectStartLocation.x,n.x),o=Math.max(t.boxSelectStartLocation.x,n.x),i=Math.min(t.boxSelectStartLocation.y,n.y),s=Math.max(t.boxSelectStartLocation.y,n.y),a="translate("+r+"px, "+i+"px)";t.boxSelectElement.style.transform=a,t.boxSelectElement.style.WebkitTransform=a,t.boxSelectElement.style.width=o-r+"px",t.boxSelectElement.style.height=s-i+"px"},te.dragMove=function(t,e){t.dragMoving=!0,e.originalEvent.stopPropagation();var n={lng:e.lngLat.lng-t.dragMoveLocation.lng,lat:e.lngLat.lat-t.dragMoveLocation.lat};Qt(this.getSelected(),n),t.dragMoveLocation=e.lngLat},te.onTouchEnd=te.onMouseUp=function(t,e){var n=this;if(t.dragMoving)this.fireUpdate();else if(t.boxSelecting){var r=[t.boxSelectStartLocation,vt(e.originalEvent,this.map.getContainer())],o=this.featuresAt(null,r,"click"),i=this.getUniqueIds(o).filter((function(t){return!n.isSelected(t)}));i.length&&(this.select(i),i.forEach((function(t){return n.doRender(t)})),this.updateUIClasses({mouse:p.MOVE}))}this.stopExtendedInteractions(t)},te.toDisplayFeatures=function(t,e,n){e.properties.active=this.isSelected(e.properties.id)?v.ACTIVE:v.INACTIVE,n(e),this.fireActionable(),e.properties.active===v.ACTIVE&&e.geometry.type!==f.POINT&&_t(e).forEach(n)},te.onTrash=function(){this.deleteFeature(this.getSelectedIds()),this.fireActionable()},te.onCombineFeatures=function(){var t=this.getSelected();if(!(0===t.length||t.length<2)){for(var e=[],n=[],r=t[0].type.replace("Multi",""),o=0;o<t.length;o++){var i=t[o];if(i.type.replace("Multi","")!==r)return;i.type.includes("Multi")?i.getCoordinates().forEach((function(t){e.push(t)})):e.push(i.getCoordinates()),n.push(i.toGeoJSON())}if(n.length>1){var s=this.newFeature({type:f.FEATURE,properties:n[0].properties,geometry:{type:"Multi"+r,coordinates:e}});this.addFeature(s),this.deleteFeature(this.getSelectedIds(),{silent:!0}),this.setSelected([s.id]),this.map.fire(g.COMBINE_FEATURES,{createdFeatures:[s.toGeoJSON()],deletedFeatures:n})}this.fireActionable()}},te.onUncombineFeatures=function(){var t=this,e=this.getSelected();if(0!==e.length){for(var n=[],r=[],o=function(o){var i=e[o];t.isInstanceOf("MultiFeature",i)&&(i.getFeatures().forEach((function(e){t.addFeature(e),e.properties=i.properties,n.push(e.toGeoJSON()),t.select([e.id])})),t.deleteFeature(i.id,{silent:!0}),r.push(i.toGeoJSON()))},i=0;i<e.length;i++)o(i);n.length>1&&this.map.fire(g.UNCOMBINE_FEATURES,{createdFeatures:n,deletedFeatures:r}),this.fireActionable()}};var ee=ot(m.VERTEX),ne=ot(m.MIDPOINT),re={fireUpdate:function(){this.map.fire(g.UPDATE,{action:y.CHANGE_COORDINATES,features:this.getSelected().map((function(t){return t.toGeoJSON()}))})},fireActionable:function(t){this.setActionableState({combineFeatures:!1,uncombineFeatures:!1,trash:t.selectedCoordPaths.length>0})},startDragging:function(t,e){this.map.dragPan.disable(),t.canDragMove=!0,t.dragMoveLocation=e.lngLat},stopDragging:function(t){this.map.dragPan.enable(),t.dragMoving=!1,t.canDragMove=!1,t.dragMoveLocation=null},onVertex:function(t,e){this.startDragging(t,e);var n=e.featureTarget.properties,r=t.selectedCoordPaths.indexOf(n.coord_path);pt(e)||-1!==r?pt(e)&&-1===r&&t.selectedCoordPaths.push(n.coord_path):t.selectedCoordPaths=[n.coord_path];var o=this.pathsToCoordinates(t.featureId,t.selectedCoordPaths);this.setSelectedCoordinates(o)},onMidpoint:function(t,e){this.startDragging(t,e);var n=e.featureTarget.properties;t.feature.addCoordinate(n.coord_path,n.lng,n.lat),this.fireUpdate(),t.selectedCoordPaths=[n.coord_path]},pathsToCoordinates:function(t,e){return e.map((function(e){return{feature_id:t,coord_path:e}}))},onFeature:function(t,e){0===t.selectedCoordPaths.length?this.startDragging(t,e):this.stopDragging(t)},dragFeature:function(t,e,n){Qt(this.getSelected(),n),t.dragMoveLocation=e.lngLat},dragVertex:function(t,e,n){for(var r=t.selectedCoordPaths.map((function(e){return t.feature.getCoordinate(e)})),o=Kt(r.map((function(t){return{type:f.FEATURE,properties:{},geometry:{type:f.POINT,coordinates:t}}})),n),i=0;i<r.length;i++){var s=r[i];t.feature.updateCoordinate(t.selectedCoordPaths[i],s[0]+o.lng,s[1]+o.lat)}},clickNoTarget:function(){this.changeMode(d.SIMPLE_SELECT)},clickInactive:function(){this.changeMode(d.SIMPLE_SELECT)},clickActiveFeature:function(t){t.selectedCoordPaths=[],this.clearSelectedCoordinates(),t.feature.changed()},onSetup:function(t){var e=t.featureId,n=this.getFeature(e);if(!n)throw new Error("You must provide a featureId to enter direct_select mode");if(n.type===f.POINT)throw new TypeError("direct_select mode doesn't handle point features");var r={featureId:e,feature:n,dragMoveLocation:t.startPos||null,dragMoving:!1,canDragMove:!1,selectedCoordPaths:t.coordPath?[t.coordPath]:[]};return this.setSelectedCoordinates(this.pathsToCoordinates(e,r.selectedCoordPaths)),this.setSelected(e),xt.disable(this),this.setActionableState({trash:!0}),r},onStop:function(){xt.enable(this),this.clearSelectedCoordinates()},toDisplayFeatures:function(t,e,n){t.featureId===e.properties.id?(e.properties.active=v.ACTIVE,n(e),_t(e,{map:this.map,midpoints:!0,selectedPaths:t.selectedCoordPaths}).forEach(n)):(e.properties.active=v.INACTIVE,n(e)),this.fireActionable(t)},onTrash:function(t){t.selectedCoordPaths.sort((function(t,e){return e.localeCompare(t,"en",{numeric:!0})})).forEach((function(e){return t.feature.removeCoordinate(e)})),this.fireUpdate(),t.selectedCoordPaths=[],this.clearSelectedCoordinates(),this.fireActionable(t),!1===t.feature.isValid()&&(this.deleteFeature([t.featureId]),this.changeMode(d.SIMPLE_SELECT,{}))},onMouseMove:function(t,e){var n=st(e),r=ee(e),o=ne(e),i=0===t.selectedCoordPaths.length;return n&&i||r&&!i?this.updateUIClasses({mouse:p.MOVE}):this.updateUIClasses({mouse:p.NONE}),(r||n||o)&&t.dragMoving&&this.fireUpdate(),this.stopDragging(t),!0},onMouseOut:function(t){return t.dragMoving&&this.fireUpdate(),!0}};re.onTouchStart=re.onMouseDown=function(t,e){return ee(e)?this.onVertex(t,e):st(e)?this.onFeature(t,e):ne(e)?this.onMidpoint(t,e):void 0},re.onDrag=function(t,e){if(!0===t.canDragMove){t.dragMoving=!0,e.originalEvent.stopPropagation();var n={lng:e.lngLat.lng-t.dragMoveLocation.lng,lat:e.lngLat.lat-t.dragMoveLocation.lat};t.selectedCoordPaths.length>0?this.dragVertex(t,e,n):this.dragFeature(t,e,n),t.dragMoveLocation=e.lngLat}},re.onClick=function(t,e){return ut(e)?this.clickNoTarget(t,e):st(e)?this.clickActiveFeature(t,e):at(e)?this.clickInactive(t,e):void this.stopDragging(t)},re.onTap=function(t,e){return ut(e)?this.clickNoTarget(t,e):st(e)?this.clickActiveFeature(t,e):at(e)?this.clickInactive(t,e):void 0},re.onTouchEnd=re.onMouseUp=function(t){t.dragMoving&&this.fireUpdate(),this.stopDragging(t)};var oe={};function ie(t,e){return!!t.lngLat&&t.lngLat.lng===e[0]&&t.lngLat.lat===e[1]}oe.onSetup=function(){var t=this.newFeature({type:f.FEATURE,properties:{},geometry:{type:f.POINT,coordinates:[]}});return this.addFeature(t),this.clearSelectedFeatures(),this.updateUIClasses({mouse:p.ADD}),this.activateUIButton(h.POINT),this.setActionableState({trash:!0}),{point:t}},oe.stopDrawingAndRemove=function(t){this.deleteFeature([t.point.id],{silent:!0}),this.changeMode(d.SIMPLE_SELECT)},oe.onTap=oe.onClick=function(t,e){this.updateUIClasses({mouse:p.MOVE}),t.point.updateCoordinate("",e.lngLat.lng,e.lngLat.lat),this.map.fire(g.CREATE,{features:[t.point.toGeoJSON()]}),this.changeMode(d.SIMPLE_SELECT,{featureIds:[t.point.id]})},oe.onStop=function(t){this.activateUIButton(),t.point.getCoordinate().length||this.deleteFeature([t.point.id],{silent:!0})},oe.toDisplayFeatures=function(t,e,n){var r=e.properties.id===t.point.id;if(e.properties.active=r?v.ACTIVE:v.INACTIVE,!r)return n(e)},oe.onTrash=oe.stopDrawingAndRemove,oe.onKeyUp=function(t,e){if(ht(e)||ft(e))return this.stopDrawingAndRemove(t,e)};var se={onSetup:function(){var t=this.newFeature({type:f.FEATURE,properties:{},geometry:{type:f.POLYGON,coordinates:[[]]}});return this.addFeature(t),this.clearSelectedFeatures(),xt.disable(this),this.updateUIClasses({mouse:p.ADD}),this.activateUIButton(h.POLYGON),this.setActionableState({trash:!0}),{polygon:t,currentVertexPosition:0}},clickAnywhere:function(t,e){if(t.currentVertexPosition>0&&ie(e,t.polygon.coordinates[0][t.currentVertexPosition-1]))return this.changeMode(d.SIMPLE_SELECT,{featureIds:[t.polygon.id]});this.updateUIClasses({mouse:p.ADD}),t.polygon.updateCoordinate("0."+t.currentVertexPosition,e.lngLat.lng,e.lngLat.lat),t.currentVertexPosition++,t.polygon.updateCoordinate("0."+t.currentVertexPosition,e.lngLat.lng,e.lngLat.lat)},clickOnVertex:function(t){return this.changeMode(d.SIMPLE_SELECT,{featureIds:[t.polygon.id]})},onMouseMove:function(t,e){t.polygon.updateCoordinate("0."+t.currentVertexPosition,e.lngLat.lng,e.lngLat.lat),lt(e)&&this.updateUIClasses({mouse:p.POINTER})}};se.onTap=se.onClick=function(t,e){return lt(e)?this.clickOnVertex(t,e):this.clickAnywhere(t,e)},se.onKeyUp=function(t,e){ht(e)?(this.deleteFeature([t.polygon.id],{silent:!0}),this.changeMode(d.SIMPLE_SELECT)):ft(e)&&this.changeMode(d.SIMPLE_SELECT,{featureIds:[t.polygon.id]})},se.onStop=function(t){this.updateUIClasses({mouse:p.NONE}),xt.enable(this),this.activateUIButton(),void 0!==this.getFeature(t.polygon.id)&&(t.polygon.removeCoordinate("0."+t.currentVertexPosition),t.polygon.isValid()?this.map.fire(g.CREATE,{features:[t.polygon.toGeoJSON()]}):(this.deleteFeature([t.polygon.id],{silent:!0}),this.changeMode(d.SIMPLE_SELECT,{},{silent:!0})))},se.toDisplayFeatures=function(t,e,n){var r=e.properties.id===t.polygon.id;if(e.properties.active=r?v.ACTIVE:v.INACTIVE,!r)return n(e);if(0!==e.geometry.coordinates.length){var o=e.geometry.coordinates[0].length;if(!(o<3)){if(e.properties.meta=m.FEATURE,n(bt(t.polygon.id,e.geometry.coordinates[0][0],"0.0",!1)),o>3){var i=e.geometry.coordinates[0].length-3;n(bt(t.polygon.id,e.geometry.coordinates[0][i],"0."+i,!1))}if(o<=4){var s=[[e.geometry.coordinates[0][0][0],e.geometry.coordinates[0][0][1]],[e.geometry.coordinates[0][1][0],e.geometry.coordinates[0][1][1]]];if(n({type:f.FEATURE,properties:e.properties,geometry:{coordinates:s,type:f.LINE_STRING}}),3===o)return}return n(e)}}},se.onTrash=function(t){this.deleteFeature([t.polygon.id],{silent:!0}),this.changeMode(d.SIMPLE_SELECT)};var ae={onSetup:function(t){var e,n,r=(t=t||{}).featureId,o="forward";if(r){if(!(e=this.getFeature(r)))throw new Error("Could not find a feature with the provided featureId");var i=t.from;if(i&&"Feature"===i.type&&i.geometry&&"Point"===i.geometry.type&&(i=i.geometry),i&&"Point"===i.type&&i.coordinates&&2===i.coordinates.length&&(i=i.coordinates),!i||!Array.isArray(i))throw new Error("Please use the `from` property to indicate which point to continue the line from");var s=e.coordinates.length-1;if(e.coordinates[s][0]===i[0]&&e.coordinates[s][1]===i[1])n=s+1,e.addCoordinate.apply(e,[n].concat(e.coordinates[s]));else{if(e.coordinates[0][0]!==i[0]||e.coordinates[0][1]!==i[1])throw new Error("`from` should match the point at either the start or the end of the provided LineString");o="backwards",n=0,e.addCoordinate.apply(e,[n].concat(e.coordinates[0]))}}else e=this.newFeature({type:f.FEATURE,properties:{},geometry:{type:f.LINE_STRING,coordinates:[]}}),n=0,this.addFeature(e);return this.clearSelectedFeatures(),xt.disable(this),this.updateUIClasses({mouse:p.ADD}),this.activateUIButton(h.LINE),this.setActionableState({trash:!0}),{line:e,currentVertexPosition:n,direction:o}},clickAnywhere:function(t,e){if(t.currentVertexPosition>0&&ie(e,t.line.coordinates[t.currentVertexPosition-1])||"backwards"===t.direction&&ie(e,t.line.coordinates[t.currentVertexPosition+1]))return this.changeMode(d.SIMPLE_SELECT,{featureIds:[t.line.id]});this.updateUIClasses({mouse:p.ADD}),t.line.updateCoordinate(t.currentVertexPosition,e.lngLat.lng,e.lngLat.lat),"forward"===t.direction?(t.currentVertexPosition++,t.line.updateCoordinate(t.currentVertexPosition,e.lngLat.lng,e.lngLat.lat)):t.line.addCoordinate(0,e.lngLat.lng,e.lngLat.lat)},clickOnVertex:function(t){return this.changeMode(d.SIMPLE_SELECT,{featureIds:[t.line.id]})},onMouseMove:function(t,e){t.line.updateCoordinate(t.currentVertexPosition,e.lngLat.lng,e.lngLat.lat),lt(e)&&this.updateUIClasses({mouse:p.POINTER})}};ae.onTap=ae.onClick=function(t,e){if(lt(e))return this.clickOnVertex(t,e);this.clickAnywhere(t,e)},ae.onKeyUp=function(t,e){ft(e)?this.changeMode(d.SIMPLE_SELECT,{featureIds:[t.line.id]}):ht(e)&&(this.deleteFeature([t.line.id],{silent:!0}),this.changeMode(d.SIMPLE_SELECT))},ae.onStop=function(t){xt.enable(this),this.activateUIButton(),void 0!==this.getFeature(t.line.id)&&(t.line.removeCoordinate(""+t.currentVertexPosition),t.line.isValid()?this.map.fire(g.CREATE,{features:[t.line.toGeoJSON()]}):(this.deleteFeature([t.line.id],{silent:!0}),this.changeMode(d.SIMPLE_SELECT,{},{silent:!0})))},ae.onTrash=function(t){this.deleteFeature([t.line.id],{silent:!0}),this.changeMode(d.SIMPLE_SELECT)},ae.toDisplayFeatures=function(t,e,n){var r=e.properties.id===t.line.id;if(e.properties.active=r?v.ACTIVE:v.INACTIVE,!r)return n(e);e.geometry.coordinates.length<2||(e.properties.meta=m.FEATURE,n(bt(t.line.id,e.geometry.coordinates["forward"===t.direction?e.geometry.coordinates.length-2:1],""+("forward"===t.direction?e.geometry.coordinates.length-2:1),!1)),n(e))};var ue={simple_select:te,direct_select:re,draw_point:oe,draw_polygon:se,draw_line_string:ae},ce={defaultMode:d.SIMPLE_SELECT,keybindings:!0,touchEnabled:!0,clickBuffer:2,touchBuffer:25,boxSelect:!0,displayControlsDefault:!0,styles:rt,modes:ue,controls:{},userProperties:!1},le={point:!0,line_string:!0,polygon:!0,trash:!0,combine_features:!0,uncombine_features:!0},pe={point:!1,line_string:!1,polygon:!1,trash:!1,combine_features:!1,uncombine_features:!1};function he(t,e){return t.map((function(t){return t.source?t:tt(t,{id:t.id+"."+e,source:"hot"===e?l.HOT:l.COLD})}))}var fe={exports:{}};!function(t,e){var r="__lodash_hash_undefined__",o=9007199254740991,i="[object Arguments]",s="[object Array]",a="[object Boolean]",u="[object Date]",c="[object Error]",l="[object Function]",p="[object Map]",h="[object Number]",f="[object Object]",d="[object Promise]",g="[object RegExp]",y="[object Set]",m="[object String]",v="[object Symbol]",b="[object WeakMap]",E="[object ArrayBuffer]",_="[object DataView]",x=/^\[object .+?Constructor\]$/,S=/^(?:0|[1-9]\d*)$/,w={};w["[object Float32Array]"]=w["[object Float64Array]"]=w["[object Int8Array]"]=w["[object Int16Array]"]=w["[object Int32Array]"]=w["[object Uint8Array]"]=w["[object Uint8ClampedArray]"]=w["[object Uint16Array]"]=w["[object Uint32Array]"]=!0,w[i]=w[s]=w[E]=w[a]=w[_]=w[u]=w[c]=w[l]=w[p]=w[h]=w[f]=w[g]=w[y]=w[m]=w[b]=!1;var I="object"==typeof n.g&&n.g&&n.g.Object===Object&&n.g,O="object"==typeof self&&self&&self.Object===Object&&self,C=I||O||Function("return this")(),T=e&&!e.nodeType&&e,P=T&&t&&!t.nodeType&&t,M=P&&P.exports===T,L=M&&I.process,A=function(){try{return L&&L.binding&&L.binding("util")}catch(t){}}(),N=A&&A.isTypedArray;function F(t,e){for(var n=-1,r=null==t?0:t.length;++n<r;)if(e(t[n],n,t))return!0;return!1}function R(t){var e=-1,n=Array(t.size);return t.forEach((function(t,r){n[++e]=[r,t]})),n}function k(t){var e=-1,n=Array(t.size);return t.forEach((function(t){n[++e]=t})),n}var D,U,j,G=Array.prototype,V=Function.prototype,B=Object.prototype,z=C["__core-js_shared__"],$=V.toString,J=B.hasOwnProperty,q=(D=/[^.]+$/.exec(z&&z.keys&&z.keys.IE_PROTO||""))?"Symbol(src)_1."+D:"",Y=B.toString,H=RegExp("^"+$.call(J).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Z=M?C.Buffer:void 0,X=C.Symbol,W=C.Uint8Array,K=B.propertyIsEnumerable,Q=G.splice,tt=X?X.toStringTag:void 0,et=Object.getOwnPropertySymbols,nt=Z?Z.isBuffer:void 0,rt=(U=Object.keys,j=Object,function(t){return U(j(t))}),ot=At(C,"DataView"),it=At(C,"Map"),st=At(C,"Promise"),at=At(C,"Set"),ut=At(C,"WeakMap"),ct=At(Object,"create"),lt=kt(ot),pt=kt(it),ht=kt(st),ft=kt(at),dt=kt(ut),gt=X?X.prototype:void 0,yt=gt?gt.valueOf:void 0;function mt(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function vt(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function bt(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function Et(t){var e=-1,n=null==t?0:t.length;for(this.__data__=new bt;++e<n;)this.add(t[e])}function _t(t){var e=this.__data__=new vt(t);this.size=e.size}function xt(t,e){var n=jt(t),r=!n&&Ut(t),o=!n&&!r&&Gt(t),i=!n&&!r&&!o&&Jt(t),s=n||r||o||i,a=s?function(t,e){for(var n=-1,r=Array(t);++n<t;)r[n]=e(n);return r}(t.length,String):[],u=a.length;for(var c in t)!e&&!J.call(t,c)||s&&("length"==c||o&&("offset"==c||"parent"==c)||i&&("buffer"==c||"byteLength"==c||"byteOffset"==c)||Rt(c,u))||a.push(c);return a}function St(t,e){for(var n=t.length;n--;)if(Dt(t[n][0],e))return n;return-1}function wt(t){return null==t?void 0===t?"[object Undefined]":"[object Null]":tt&&tt in Object(t)?function(t){var e=J.call(t,tt),n=t[tt];try{t[tt]=void 0;var r=!0}catch(t){}var o=Y.call(t);return r&&(e?t[tt]=n:delete t[tt]),o}(t):function(t){return Y.call(t)}(t)}function It(t){return $t(t)&&wt(t)==i}function Ot(t,e,n,r,o){return t===e||(null==t||null==e||!$t(t)&&!$t(e)?t!=t&&e!=e:function(t,e,n,r,o,l){var d=jt(t),b=jt(e),x=d?s:Ft(t),S=b?s:Ft(e),w=(x=x==i?f:x)==f,I=(S=S==i?f:S)==f,O=x==S;if(O&&Gt(t)){if(!Gt(e))return!1;d=!0,w=!1}if(O&&!w)return l||(l=new _t),d||Jt(t)?Pt(t,e,n,r,o,l):function(t,e,n,r,o,i,s){switch(n){case _:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case E:return!(t.byteLength!=e.byteLength||!i(new W(t),new W(e)));case a:case u:case h:return Dt(+t,+e);case c:return t.name==e.name&&t.message==e.message;case g:case m:return t==e+"";case p:var l=R;case y:var f=1&r;if(l||(l=k),t.size!=e.size&&!f)return!1;var d=s.get(t);if(d)return d==e;r|=2,s.set(t,e);var b=Pt(l(t),l(e),r,o,i,s);return s.delete(t),b;case v:if(yt)return yt.call(t)==yt.call(e)}return!1}(t,e,x,n,r,o,l);if(!(1&n)){var C=w&&J.call(t,"__wrapped__"),T=I&&J.call(e,"__wrapped__");if(C||T){var P=C?t.value():t,M=T?e.value():e;return l||(l=new _t),o(P,M,n,r,l)}}return!!O&&(l||(l=new _t),function(t,e,n,r,o,i){var s=1&n,a=Mt(t),u=a.length;if(u!=Mt(e).length&&!s)return!1;for(var c=u;c--;){var l=a[c];if(!(s?l in e:J.call(e,l)))return!1}var p=i.get(t);if(p&&i.get(e))return p==e;var h=!0;i.set(t,e),i.set(e,t);for(var f=s;++c<u;){var d=t[l=a[c]],g=e[l];if(r)var y=s?r(g,d,l,e,t,i):r(d,g,l,t,e,i);if(!(void 0===y?d===g||o(d,g,n,r,i):y)){h=!1;break}f||(f="constructor"==l)}if(h&&!f){var m=t.constructor,v=e.constructor;m==v||!("constructor"in t)||!("constructor"in e)||"function"==typeof m&&m instanceof m&&"function"==typeof v&&v instanceof v||(h=!1)}return i.delete(t),i.delete(e),h}(t,e,n,r,o,l))}(t,e,n,r,Ot,o))}function Ct(t){return!(!zt(t)||function(t){return!!q&&q in t}(t))&&(Vt(t)?H:x).test(kt(t))}function Tt(t){if(n=(e=t)&&e.constructor,e!==("function"==typeof n&&n.prototype||B))return rt(t);var e,n,r=[];for(var o in Object(t))J.call(t,o)&&"constructor"!=o&&r.push(o);return r}function Pt(t,e,n,r,o,i){var s=1&n,a=t.length,u=e.length;if(a!=u&&!(s&&u>a))return!1;var c=i.get(t);if(c&&i.get(e))return c==e;var l=-1,p=!0,h=2&n?new Et:void 0;for(i.set(t,e),i.set(e,t);++l<a;){var f=t[l],d=e[l];if(r)var g=s?r(d,f,l,e,t,i):r(f,d,l,t,e,i);if(void 0!==g){if(g)continue;p=!1;break}if(h){if(!F(e,(function(t,e){if(s=e,!h.has(s)&&(f===t||o(f,t,n,r,i)))return h.push(e);var s}))){p=!1;break}}else if(f!==d&&!o(f,d,n,r,i)){p=!1;break}}return i.delete(t),i.delete(e),p}function Mt(t){return function(t,e,n){var r=e(t);return jt(t)?r:function(t,e){for(var n=-1,r=e.length,o=t.length;++n<r;)t[o+n]=e[n];return t}(r,n(t))}(t,qt,Nt)}function Lt(t,e){var n,r,o=t.__data__;return("string"==(r=typeof(n=e))||"number"==r||"symbol"==r||"boolean"==r?"__proto__"!==n:null===n)?o["string"==typeof e?"string":"hash"]:o.map}function At(t,e){var n=function(t,e){return null==t?void 0:t[e]}(t,e);return Ct(n)?n:void 0}mt.prototype.clear=function(){this.__data__=ct?ct(null):{},this.size=0},mt.prototype.delete=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e},mt.prototype.get=function(t){var e=this.__data__;if(ct){var n=e[t];return n===r?void 0:n}return J.call(e,t)?e[t]:void 0},mt.prototype.has=function(t){var e=this.__data__;return ct?void 0!==e[t]:J.call(e,t)},mt.prototype.set=function(t,e){var n=this.__data__;return this.size+=this.has(t)?0:1,n[t]=ct&&void 0===e?r:e,this},vt.prototype.clear=function(){this.__data__=[],this.size=0},vt.prototype.delete=function(t){var e=this.__data__,n=St(e,t);return!(n<0||(n==e.length-1?e.pop():Q.call(e,n,1),--this.size,0))},vt.prototype.get=function(t){var e=this.__data__,n=St(e,t);return n<0?void 0:e[n][1]},vt.prototype.has=function(t){return St(this.__data__,t)>-1},vt.prototype.set=function(t,e){var n=this.__data__,r=St(n,t);return r<0?(++this.size,n.push([t,e])):n[r][1]=e,this},bt.prototype.clear=function(){this.size=0,this.__data__={hash:new mt,map:new(it||vt),string:new mt}},bt.prototype.delete=function(t){var e=Lt(this,t).delete(t);return this.size-=e?1:0,e},bt.prototype.get=function(t){return Lt(this,t).get(t)},bt.prototype.has=function(t){return Lt(this,t).has(t)},bt.prototype.set=function(t,e){var n=Lt(this,t),r=n.size;return n.set(t,e),this.size+=n.size==r?0:1,this},Et.prototype.add=Et.prototype.push=function(t){return this.__data__.set(t,r),this},Et.prototype.has=function(t){return this.__data__.has(t)},_t.prototype.clear=function(){this.__data__=new vt,this.size=0},_t.prototype.delete=function(t){var e=this.__data__,n=e.delete(t);return this.size=e.size,n},_t.prototype.get=function(t){return this.__data__.get(t)},_t.prototype.has=function(t){return this.__data__.has(t)},_t.prototype.set=function(t,e){var n=this.__data__;if(n instanceof vt){var r=n.__data__;if(!it||r.length<199)return r.push([t,e]),this.size=++n.size,this;n=this.__data__=new bt(r)}return n.set(t,e),this.size=n.size,this};var Nt=et?function(t){return null==t?[]:(t=Object(t),function(t,e){for(var n=-1,r=null==t?0:t.length,o=0,i=[];++n<r;){var s=t[n];e(s,n,t)&&(i[o++]=s)}return i}(et(t),(function(e){return K.call(t,e)})))}:function(){return[]},Ft=wt;function Rt(t,e){return!!(e=null==e?o:e)&&("number"==typeof t||S.test(t))&&t>-1&&t%1==0&&t<e}function kt(t){if(null!=t){try{return $.call(t)}catch(t){}try{return t+""}catch(t){}}return""}function Dt(t,e){return t===e||t!=t&&e!=e}(ot&&Ft(new ot(new ArrayBuffer(1)))!=_||it&&Ft(new it)!=p||st&&Ft(st.resolve())!=d||at&&Ft(new at)!=y||ut&&Ft(new ut)!=b)&&(Ft=function(t){var e=wt(t),n=e==f?t.constructor:void 0,r=n?kt(n):"";if(r)switch(r){case lt:return _;case pt:return p;case ht:return d;case ft:return y;case dt:return b}return e});var Ut=It(function(){return arguments}())?It:function(t){return $t(t)&&J.call(t,"callee")&&!K.call(t,"callee")},jt=Array.isArray,Gt=nt||function(){return!1};function Vt(t){if(!zt(t))return!1;var e=wt(t);return e==l||"[object GeneratorFunction]"==e||"[object AsyncFunction]"==e||"[object Proxy]"==e}function Bt(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=o}function zt(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}function $t(t){return null!=t&&"object"==typeof t}var Jt=N?function(t){return function(e){return t(e)}}(N):function(t){return $t(t)&&Bt(t.length)&&!!w[wt(t)]};function qt(t){return null!=(e=t)&&Bt(e.length)&&!Vt(e)?xt(t):Tt(t);var e}t.exports=function(t,e){return Ot(t,e)}}(fe,fe.exports);var de=e(fe.exports);function ge(t,e){return t.length===e.length&&JSON.stringify(t.map((function(t){return t})).sort())===JSON.stringify(e.map((function(t){return t})).sort())}var ye={Polygon:G,LineString:j,Point:U,MultiPolygon:z,MultiLineString:z,MultiPoint:z},me=Object.freeze({__proto__:null,CommonSelectors:dt,constrainFeatureMovement:Kt,createMidPoint:Et,createSupplementaryPoints:_t,createVertex:bt,doubleClickZoom:xt,euclideanDistance:L,featuresAt:T,getFeatureAtAndSetCursors:M,isClick:A,isEventAtCoordinates:ie,isTap:N,mapEventToBoundingBox:I,ModeHandler:t,moveFeatures:Qt,sortFeatures:w,stringSetsAreEqual:ge,StringSet:O,theme:rt,toDenseArray:H}),ve=function(t,e){var n={options:t=function(t){void 0===t&&(t={});var e=tt(t);return t.controls||(e.controls={}),!1===t.displayControlsDefault?e.controls=tt(pe,t.controls):e.controls=tt(le,t.controls),(e=tt(ce,e)).styles=he(e.styles,"cold").concat(he(e.styles,"hot")),e}(t)};e=function(t,e){return e.modes=d,e.getFeatureIdsAt=function(e){return T.click({point:e},null,t).map((function(t){return t.properties.id}))},e.getSelectedIds=function(){return t.store.getSelectedIds()},e.getSelected=function(){return{type:f.FEATURE_COLLECTION,features:t.store.getSelectedIds().map((function(e){return t.store.get(e)})).map((function(t){return t.toGeoJSON()}))}},e.getSelectedPoints=function(){return{type:f.FEATURE_COLLECTION,features:t.store.getSelectedCoordinates().map((function(t){return{type:f.FEATURE,properties:{},geometry:{type:f.POINT,coordinates:t.coordinates}}}))}},e.set=function(n){if(void 0===n.type||n.type!==f.FEATURE_COLLECTION||!Array.isArray(n.features))throw new Error("Invalid FeatureCollection");var r=t.store.createRenderBatch(),o=t.store.getAllIds().slice(),i=e.add(n),s=new O(i);return(o=o.filter((function(t){return!s.has(t)}))).length&&e.delete(o),r(),i},e.add=function(e){var n=JSON.parse(JSON.stringify(Ot(e))).features.map((function(e){if(e.id=e.id||k(),null===e.geometry)throw new Error("Invalid geometry: null");if(void 0===t.store.get(e.id)||t.store.get(e.id).type!==e.geometry.type){var n=ye[e.geometry.type];if(void 0===n)throw new Error("Invalid geometry type: "+e.geometry.type+".");var r=new n(t,e);t.store.add(r)}else{var o=t.store.get(e.id);o.properties=e.properties,de(o.properties,e.properties)||t.store.featureChanged(o.id),de(o.getCoordinates(),e.geometry.coordinates)||o.incomingCoords(e.geometry.coordinates)}return e.id}));return t.store.render(),n},e.get=function(e){var n=t.store.get(e);if(n)return n.toGeoJSON()},e.getAll=function(){return{type:f.FEATURE_COLLECTION,features:t.store.getAll().map((function(t){return t.toGeoJSON()}))}},e.delete=function(n){return t.store.delete(n,{silent:!0}),e.getMode()!==d.DIRECT_SELECT||t.store.getSelectedIds().length?t.store.render():t.events.changeMode(d.SIMPLE_SELECT,void 0,{silent:!0}),e},e.deleteAll=function(){return t.store.delete(t.store.getAllIds(),{silent:!0}),e.getMode()===d.DIRECT_SELECT?t.events.changeMode(d.SIMPLE_SELECT,void 0,{silent:!0}):t.store.render(),e},e.changeMode=function(n,r){return void 0===r&&(r={}),n===d.SIMPLE_SELECT&&e.getMode()===d.SIMPLE_SELECT?(ge(r.featureIds||[],t.store.getSelectedIds())||(t.store.setSelected(r.featureIds,{silent:!0}),t.store.render()),e):(n===d.DIRECT_SELECT&&e.getMode()===d.DIRECT_SELECT&&r.featureId===t.store.getSelectedIds()[0]||t.events.changeMode(n,r,{silent:!0}),e)},e.getMode=function(){return t.events.getMode()},e.trash=function(){return t.events.trash({silent:!0}),e},e.combineFeatures=function(){return t.events.combineFeatures({silent:!0}),e},e.uncombineFeatures=function(){return t.events.uncombineFeatures({silent:!0}),e},e.setFeatureProperty=function(n,r,o){return t.store.setFeatureProperty(n,r,o),e},e}(n,e),n.api=e;var r=nt(n);return e.onAdd=r.onAdd,e.onRemove=r.onRemove,e.types=h,e.options=t,e};function be(t){ve(t,this)}return be.modes=ue,be.constants=_,be.lib=me,be}()},180:function(t){t.exports=function(){"use strict";function t(t,e){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(t){return function(e){return u([t,e])}}function u(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!((o=(o=s.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=e.call(t,s)}catch(t){i=[6,t],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}}var e=function(){function t(t,e){this.next=null,this.key=t,this.data=e,this.left=null,this.right=null}return t}();function n(t,e){return t>e?1:t<e?-1:0}function r(t,n,r){for(var o=new e(null,null),i=o,s=o;;){var a=r(t,n.key);if(a<0){if(null===n.left)break;if(r(t,n.left.key)<0){var u=n.left;if(n.left=u.right,u.right=n,null===(n=u).left)break}s.left=n,s=n,n=n.left}else{if(!(a>0))break;if(null===n.right)break;if(r(t,n.right.key)>0&&(u=n.right,n.right=u.left,u.left=n,null===(n=u).right))break;i.right=n,i=n,n=n.right}}return i.right=n.left,s.left=n.right,n.left=o.right,n.right=o.left,n}function o(t,n,o,i){var s=new e(t,n);if(null===o)return s.left=s.right=null,s;var a=i(t,(o=r(t,o,i)).key);return a<0?(s.left=o.left,s.right=o,o.left=null):a>=0&&(s.right=o.right,s.left=o,o.right=null),s}function i(t,e,n){var o=null,i=null;if(e){var s=n((e=r(t,e,n)).key,t);0===s?(o=e.left,i=e.right):s<0?(i=e.right,e.right=null,o=e):(o=e.left,e.left=null,i=e)}return{left:o,right:i}}function s(t,e,n){return null===e?t:(null===t||((e=r(t.key,e,n)).left=t),e)}function a(t,e,n,r,o){if(t){r(e+(n?"└── ":"├── ")+o(t)+"\n");var i=e+(n?"    ":"│   ");t.left&&a(t.left,i,!1,r,o),t.right&&a(t.right,i,!0,r,o)}}var u=function(){function u(t){void 0===t&&(t=n),this._root=null,this._size=0,this._comparator=t}return u.prototype.insert=function(t,e){return this._size++,this._root=o(t,e,this._root,this._comparator)},u.prototype.add=function(t,n){var o=new e(t,n);null===this._root&&(o.left=o.right=null,this._size++,this._root=o);var i=this._comparator,s=r(t,this._root,i),a=i(t,s.key);return 0===a?this._root=s:(a<0?(o.left=s.left,o.right=s,s.left=null):a>0&&(o.right=s.right,o.left=s,s.right=null),this._size++,this._root=o),this._root},u.prototype.remove=function(t){this._root=this._remove(t,this._root,this._comparator)},u.prototype._remove=function(t,e,n){var o;return null===e?null:0===n(t,(e=r(t,e,n)).key)?(null===e.left?o=e.right:(o=r(t,e.left,n)).right=e.right,this._size--,o):e},u.prototype.pop=function(){var t=this._root;if(t){for(;t.left;)t=t.left;return this._root=r(t.key,this._root,this._comparator),this._root=this._remove(t.key,this._root,this._comparator),{key:t.key,data:t.data}}return null},u.prototype.findStatic=function(t){for(var e=this._root,n=this._comparator;e;){var r=n(t,e.key);if(0===r)return e;e=r<0?e.left:e.right}return null},u.prototype.find=function(t){return this._root&&(this._root=r(t,this._root,this._comparator),0!==this._comparator(t,this._root.key))?null:this._root},u.prototype.contains=function(t){for(var e=this._root,n=this._comparator;e;){var r=n(t,e.key);if(0===r)return!0;e=r<0?e.left:e.right}return!1},u.prototype.forEach=function(t,e){for(var n=this._root,r=[],o=!1;!o;)null!==n?(r.push(n),n=n.left):0!==r.length?(n=r.pop(),t.call(e,n),n=n.right):o=!0;return this},u.prototype.range=function(t,e,n,r){for(var o=[],i=this._comparator,s=this._root;0!==o.length||s;)if(s)o.push(s),s=s.left;else{if(i((s=o.pop()).key,e)>0)break;if(i(s.key,t)>=0&&n.call(r,s))return this;s=s.right}return this},u.prototype.keys=function(){var t=[];return this.forEach((function(e){var n=e.key;return t.push(n)})),t},u.prototype.values=function(){var t=[];return this.forEach((function(e){var n=e.data;return t.push(n)})),t},u.prototype.min=function(){return this._root?this.minNode(this._root).key:null},u.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},u.prototype.minNode=function(t){if(void 0===t&&(t=this._root),t)for(;t.left;)t=t.left;return t},u.prototype.maxNode=function(t){if(void 0===t&&(t=this._root),t)for(;t.right;)t=t.right;return t},u.prototype.at=function(t){for(var e=this._root,n=!1,r=0,o=[];!n;)if(e)o.push(e),e=e.left;else if(o.length>0){if(e=o.pop(),r===t)return e;r++,e=e.right}else n=!0;return null},u.prototype.next=function(t){var e=this._root,n=null;if(t.right){for(n=t.right;n.left;)n=n.left;return n}for(var r=this._comparator;e;){var o=r(t.key,e.key);if(0===o)break;o<0?(n=e,e=e.left):e=e.right}return n},u.prototype.prev=function(t){var e=this._root,n=null;if(null!==t.left){for(n=t.left;n.right;)n=n.right;return n}for(var r=this._comparator;e;){var o=r(t.key,e.key);if(0===o)break;o<0?e=e.left:(n=e,e=e.right)}return n},u.prototype.clear=function(){return this._root=null,this._size=0,this},u.prototype.toList=function(){return p(this._root)},u.prototype.load=function(t,e,n){void 0===e&&(e=[]),void 0===n&&(n=!1);var r=t.length,o=this._comparator;if(n&&d(t,e,0,r-1,o),null===this._root)this._root=c(t,e,0,r),this._size=r;else{var i=f(this.toList(),l(t,e),o);r=this._size+r,this._root=h({head:i},0,r)}return this},u.prototype.isEmpty=function(){return null===this._root},Object.defineProperty(u.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),u.prototype.toString=function(t){void 0===t&&(t=function(t){return String(t.key)});var e=[];return a(this._root,"",!0,(function(t){return e.push(t)}),t),e.join("")},u.prototype.update=function(t,e,n){var r=this._comparator,a=i(t,this._root,r),u=a.left,c=a.right;r(t,e)<0?c=o(e,n,c,r):u=o(e,n,u,r),this._root=s(u,c,r)},u.prototype.split=function(t){return i(t,this._root,this._comparator)},u.prototype[Symbol.iterator]=function(){var e,n,r;return t(this,(function(t){switch(t.label){case 0:e=this._root,n=[],r=!1,t.label=1;case 1:return r?[3,6]:null===e?[3,2]:(n.push(e),e=e.left,[3,5]);case 2:return 0===n.length?[3,4]:[4,e=n.pop()];case 3:return t.sent(),e=e.right,[3,5];case 4:r=!0,t.label=5;case 5:return[3,1];case 6:return[2]}}))},u}();function c(t,n,r,o){var i=o-r;if(i>0){var s=r+Math.floor(i/2),a=t[s],u=n[s],l=new e(a,u);return l.left=c(t,n,r,s),l.right=c(t,n,s+1,o),l}return null}function l(t,n){for(var r=new e(null,null),o=r,i=0;i<t.length;i++)o=o.next=new e(t[i],n[i]);return o.next=null,r.next}function p(t){for(var n=t,r=[],o=!1,i=new e(null,null),s=i;!o;)n?(r.push(n),n=n.left):r.length>0?n=(n=s=s.next=r.pop()).right:o=!0;return s.next=null,i.next}function h(t,e,n){var r=n-e;if(r>0){var o=e+Math.floor(r/2),i=h(t,e,o),s=t.head;return s.left=i,t.head=t.head.next,s.right=h(t,o+1,n),s}return null}function f(t,n,r){for(var o=new e(null,null),i=o,s=t,a=n;null!==s&&null!==a;)r(s.key,a.key)<0?(i.next=s,s=s.next):(i.next=a,a=a.next),i=i.next;return null!==s?i.next=s:null!==a&&(i.next=a),o.next}function d(t,e,n,r,o){if(!(n>=r)){for(var i=t[n+r>>1],s=n-1,a=r+1;;){do{s++}while(o(t[s],i)<0);do{a--}while(o(t[a],i)>0);if(s>=a)break;var u=t[s];t[s]=t[a],t[a]=u,u=e[s],e[s]=e[a],e[a]=u}d(t,e,n,a,o),d(t,e,a+1,r,o)}}const g=(t,e)=>t.ll.x<=e.x&&e.x<=t.ur.x&&t.ll.y<=e.y&&e.y<=t.ur.y,y=(t,e)=>{if(e.ur.x<t.ll.x||t.ur.x<e.ll.x||e.ur.y<t.ll.y||t.ur.y<e.ll.y)return null;const n=t.ll.x<e.ll.x?e.ll.x:t.ll.x,r=t.ur.x<e.ur.x?t.ur.x:e.ur.x;return{ll:{x:n,y:t.ll.y<e.ll.y?e.ll.y:t.ll.y},ur:{x:r,y:t.ur.y<e.ur.y?t.ur.y:e.ur.y}}};let m=Number.EPSILON;void 0===m&&(m=Math.pow(2,-52));const v=m*m,b=(t,e)=>{if(-m<t&&t<m&&-m<e&&e<m)return 0;const n=t-e;return n*n<v*t*e?0:t<e?-1:1};class E{constructor(){this.reset()}reset(){this.xRounder=new _,this.yRounder=new _}round(t,e){return{x:this.xRounder.round(t),y:this.yRounder.round(e)}}}class _{constructor(){this.tree=new u,this.round(0)}round(t){const e=this.tree.add(t),n=this.tree.prev(e);if(null!==n&&0===b(e.key,n.key))return this.tree.remove(t),n.key;const r=this.tree.next(e);return null!==r&&0===b(e.key,r.key)?(this.tree.remove(t),r.key):t}}const x=new E,S=11102230246251565e-32,w=134217729,I=(3+8*S)*S;function O(t,e,n,r,o){let i,s,a,u,c=e[0],l=r[0],p=0,h=0;l>c==l>-c?(i=c,c=e[++p]):(i=l,l=r[++h]);let f=0;if(p<t&&h<n)for(l>c==l>-c?(s=c+i,a=i-(s-c),c=e[++p]):(s=l+i,a=i-(s-l),l=r[++h]),i=s,0!==a&&(o[f++]=a);p<t&&h<n;)l>c==l>-c?(s=i+c,u=s-i,a=i-(s-u)+(c-u),c=e[++p]):(s=i+l,u=s-i,a=i-(s-u)+(l-u),l=r[++h]),i=s,0!==a&&(o[f++]=a);for(;p<t;)s=i+c,u=s-i,a=i-(s-u)+(c-u),c=e[++p],i=s,0!==a&&(o[f++]=a);for(;h<n;)s=i+l,u=s-i,a=i-(s-u)+(l-u),l=r[++h],i=s,0!==a&&(o[f++]=a);return 0===i&&0!==f||(o[f++]=i),f}function C(t,e){let n=e[0];for(let r=1;r<t;r++)n+=e[r];return n}function T(t){return new Float64Array(t)}const P=(3+16*S)*S,M=(2+12*S)*S,L=(9+64*S)*S*S,A=T(4),N=T(8),F=T(12),R=T(16),k=T(4);function D(t,e,n,r,o,i,s){let a,u,c,l,p,h,f,d,g,y,m,v,b,E,_,x,S,T;const P=t-o,D=n-o,U=e-i,j=r-i;E=P*j,h=w*P,f=h-(h-P),d=P-f,h=w*j,g=h-(h-j),y=j-g,_=d*y-(E-f*g-d*g-f*y),x=U*D,h=w*U,f=h-(h-U),d=U-f,h=w*D,g=h-(h-D),y=D-g,S=d*y-(x-f*g-d*g-f*y),m=_-S,p=_-m,A[0]=_-(m+p)+(p-S),v=E+m,p=v-E,b=E-(v-p)+(m-p),m=b-x,p=b-m,A[1]=b-(m+p)+(p-x),T=v+m,p=T-v,A[2]=v-(T-p)+(m-p),A[3]=T;let G=C(4,A),V=M*s;if(G>=V||-G>=V)return G;if(p=t-P,a=t-(P+p)+(p-o),p=n-D,c=n-(D+p)+(p-o),p=e-U,u=e-(U+p)+(p-i),p=r-j,l=r-(j+p)+(p-i),0===a&&0===u&&0===c&&0===l)return G;if(V=L*s+I*Math.abs(G),G+=P*l+j*a-(U*c+D*u),G>=V||-G>=V)return G;E=a*j,h=w*a,f=h-(h-a),d=a-f,h=w*j,g=h-(h-j),y=j-g,_=d*y-(E-f*g-d*g-f*y),x=u*D,h=w*u,f=h-(h-u),d=u-f,h=w*D,g=h-(h-D),y=D-g,S=d*y-(x-f*g-d*g-f*y),m=_-S,p=_-m,k[0]=_-(m+p)+(p-S),v=E+m,p=v-E,b=E-(v-p)+(m-p),m=b-x,p=b-m,k[1]=b-(m+p)+(p-x),T=v+m,p=T-v,k[2]=v-(T-p)+(m-p),k[3]=T;const B=O(4,A,4,k,N);E=P*l,h=w*P,f=h-(h-P),d=P-f,h=w*l,g=h-(h-l),y=l-g,_=d*y-(E-f*g-d*g-f*y),x=U*c,h=w*U,f=h-(h-U),d=U-f,h=w*c,g=h-(h-c),y=c-g,S=d*y-(x-f*g-d*g-f*y),m=_-S,p=_-m,k[0]=_-(m+p)+(p-S),v=E+m,p=v-E,b=E-(v-p)+(m-p),m=b-x,p=b-m,k[1]=b-(m+p)+(p-x),T=v+m,p=T-v,k[2]=v-(T-p)+(m-p),k[3]=T;const z=O(B,N,4,k,F);E=a*l,h=w*a,f=h-(h-a),d=a-f,h=w*l,g=h-(h-l),y=l-g,_=d*y-(E-f*g-d*g-f*y),x=u*c,h=w*u,f=h-(h-u),d=u-f,h=w*c,g=h-(h-c),y=c-g,S=d*y-(x-f*g-d*g-f*y),m=_-S,p=_-m,k[0]=_-(m+p)+(p-S),v=E+m,p=v-E,b=E-(v-p)+(m-p),m=b-x,p=b-m,k[1]=b-(m+p)+(p-x),T=v+m,p=T-v,k[2]=v-(T-p)+(m-p),k[3]=T;const $=O(z,F,4,k,R);return R[$-1]}function U(t,e,n,r,o,i){const s=(e-i)*(n-o),a=(t-o)*(r-i),u=s-a,c=Math.abs(s+a);return Math.abs(u)>=P*c?u:-D(t,e,n,r,o,i,c)}const j=(t,e)=>t.x*e.y-t.y*e.x,G=(t,e)=>t.x*e.x+t.y*e.y,V=(t,e,n)=>{const r=U(t.x,t.y,e.x,e.y,n.x,n.y);return r>0?-1:r<0?1:0},B=t=>Math.sqrt(G(t,t)),z=(t,e,n)=>{const r={x:e.x-t.x,y:e.y-t.y},o={x:n.x-t.x,y:n.y-t.y};return j(o,r)/B(o)/B(r)},$=(t,e,n)=>{const r={x:e.x-t.x,y:e.y-t.y},o={x:n.x-t.x,y:n.y-t.y};return G(o,r)/B(o)/B(r)},J=(t,e,n)=>0===e.y?null:{x:t.x+e.x/e.y*(n-t.y),y:n},q=(t,e,n)=>0===e.x?null:{x:n,y:t.y+e.y/e.x*(n-t.x)},Y=(t,e,n,r)=>{if(0===e.x)return q(n,r,t.x);if(0===r.x)return q(t,e,n.x);if(0===e.y)return J(n,r,t.y);if(0===r.y)return J(t,e,n.y);const o=j(e,r);if(0==o)return null;const i={x:n.x-t.x,y:n.y-t.y},s=j(i,e)/o,a=j(i,r)/o;return{x:(t.x+a*e.x+(n.x+s*r.x))/2,y:(t.y+a*e.y+(n.y+s*r.y))/2}};class H{static compare(t,e){const n=H.comparePoints(t.point,e.point);return 0!==n?n:(t.point!==e.point&&t.link(e),t.isLeft!==e.isLeft?t.isLeft?1:-1:X.compare(t.segment,e.segment))}static comparePoints(t,e){return t.x<e.x?-1:t.x>e.x?1:t.y<e.y?-1:t.y>e.y?1:0}constructor(t,e){void 0===t.events?t.events=[this]:t.events.push(this),this.point=t,this.isLeft=e}link(t){if(t.point===this.point)throw new Error("Tried to link already linked events");const e=t.point.events;for(let t=0,n=e.length;t<n;t++){const n=e[t];this.point.events.push(n),n.point=this.point}this.checkForConsuming()}checkForConsuming(){const t=this.point.events.length;for(let e=0;e<t;e++){const n=this.point.events[e];if(void 0===n.segment.consumedBy)for(let r=e+1;r<t;r++){const t=this.point.events[r];void 0===t.consumedBy&&n.otherSE.point.events===t.otherSE.point.events&&n.segment.consume(t.segment)}}}getAvailableLinkedEvents(){const t=[];for(let e=0,n=this.point.events.length;e<n;e++){const n=this.point.events[e];n!==this&&!n.segment.ringOut&&n.segment.isInResult()&&t.push(n)}return t}getLeftmostComparator(t){const e=new Map,n=n=>{const r=n.otherSE;e.set(n,{sine:z(this.point,t.point,r.point),cosine:$(this.point,t.point,r.point)})};return(t,r)=>{e.has(t)||n(t),e.has(r)||n(r);const{sine:o,cosine:i}=e.get(t),{sine:s,cosine:a}=e.get(r);return o>=0&&s>=0?i<a?1:i>a?-1:0:o<0&&s<0?i<a?-1:i>a?1:0:s<o?-1:s>o?1:0}}}let Z=0;class X{static compare(t,e){const n=t.leftSE.point.x,r=e.leftSE.point.x,o=t.rightSE.point.x,i=e.rightSE.point.x;if(i<n)return 1;if(o<r)return-1;const s=t.leftSE.point.y,a=e.leftSE.point.y,u=t.rightSE.point.y,c=e.rightSE.point.y;if(n<r){if(a<s&&a<u)return 1;if(a>s&&a>u)return-1;const n=t.comparePoint(e.leftSE.point);if(n<0)return 1;if(n>0)return-1;const r=e.comparePoint(t.rightSE.point);return 0!==r?r:-1}if(n>r){if(s<a&&s<c)return-1;if(s>a&&s>c)return 1;const n=e.comparePoint(t.leftSE.point);if(0!==n)return n;const r=t.comparePoint(e.rightSE.point);return r<0?1:r>0?-1:1}if(s<a)return-1;if(s>a)return 1;if(o<i){const n=e.comparePoint(t.rightSE.point);if(0!==n)return n}if(o>i){const n=t.comparePoint(e.rightSE.point);if(n<0)return 1;if(n>0)return-1}if(o!==i){const t=u-s,e=o-n,l=c-a,p=i-r;if(t>e&&l<p)return 1;if(t<e&&l>p)return-1}return o>i?1:o<i||u<c?-1:u>c?1:t.id<e.id?-1:t.id>e.id?1:0}constructor(t,e,n,r){this.id=++Z,this.leftSE=t,t.segment=this,t.otherSE=e,this.rightSE=e,e.segment=this,e.otherSE=t,this.rings=n,this.windings=r}static fromRing(t,e,n){let r,o,i;const s=H.comparePoints(t,e);if(s<0)r=t,o=e,i=1;else{if(!(s>0))throw new Error(`Tried to create degenerate segment at [${t.x}, ${t.y}]`);r=e,o=t,i=-1}const a=new H(r,!0),u=new H(o,!1);return new X(a,u,[n],[i])}replaceRightSE(t){this.rightSE=t,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}bbox(){const t=this.leftSE.point.y,e=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:t<e?t:e},ur:{x:this.rightSE.point.x,y:t>e?t:e}}}vector(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}isAnEndpoint(t){return t.x===this.leftSE.point.x&&t.y===this.leftSE.point.y||t.x===this.rightSE.point.x&&t.y===this.rightSE.point.y}comparePoint(t){if(this.isAnEndpoint(t))return 0;const e=this.leftSE.point,n=this.rightSE.point,r=this.vector();if(e.x===n.x)return t.x===e.x?0:t.x<e.x?1:-1;const o=(t.y-e.y)/r.y,i=e.x+o*r.x;if(t.x===i)return 0;const s=(t.x-e.x)/r.x,a=e.y+s*r.y;return t.y===a?0:t.y<a?-1:1}getIntersection(t){const e=this.bbox(),n=t.bbox(),r=y(e,n);if(null===r)return null;const o=this.leftSE.point,i=this.rightSE.point,s=t.leftSE.point,a=t.rightSE.point,u=g(e,s)&&0===this.comparePoint(s),c=g(n,o)&&0===t.comparePoint(o),l=g(e,a)&&0===this.comparePoint(a),p=g(n,i)&&0===t.comparePoint(i);if(c&&u)return p&&!l?i:!p&&l?a:null;if(c)return l&&o.x===a.x&&o.y===a.y?null:o;if(u)return p&&i.x===s.x&&i.y===s.y?null:s;if(p&&l)return null;if(p)return i;if(l)return a;const h=Y(o,this.vector(),s,t.vector());return null===h?null:g(r,h)?x.round(h.x,h.y):null}split(t){const e=[],n=void 0!==t.events,r=new H(t,!0),o=new H(t,!1),i=this.rightSE;this.replaceRightSE(o),e.push(o),e.push(r);const s=new X(r,i,this.rings.slice(),this.windings.slice());return H.comparePoints(s.leftSE.point,s.rightSE.point)>0&&s.swapEvents(),H.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),n&&(r.checkForConsuming(),o.checkForConsuming()),e}swapEvents(){const t=this.rightSE;this.rightSE=this.leftSE,this.leftSE=t,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(let t=0,e=this.windings.length;t<e;t++)this.windings[t]*=-1}consume(t){let e=this,n=t;for(;e.consumedBy;)e=e.consumedBy;for(;n.consumedBy;)n=n.consumedBy;const r=X.compare(e,n);if(0!==r){if(r>0){const t=e;e=n,n=t}if(e.prev===n){const t=e;e=n,n=t}for(let t=0,r=n.rings.length;t<r;t++){const r=n.rings[t],o=n.windings[t],i=e.rings.indexOf(r);-1===i?(e.rings.push(r),e.windings.push(o)):e.windings[i]+=o}n.rings=null,n.windings=null,n.consumedBy=e,n.leftSE.consumedBy=e.leftSE,n.rightSE.consumedBy=e.rightSE}}prevInResult(){return void 0!==this._prevInResult||(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null),this._prevInResult}beforeState(){if(void 0!==this._beforeState)return this._beforeState;if(this.prev){const t=this.prev.consumedBy||this.prev;this._beforeState=t.afterState()}else this._beforeState={rings:[],windings:[],multiPolys:[]};return this._beforeState}afterState(){if(void 0!==this._afterState)return this._afterState;const t=this.beforeState();this._afterState={rings:t.rings.slice(0),windings:t.windings.slice(0),multiPolys:[]};const e=this._afterState.rings,n=this._afterState.windings,r=this._afterState.multiPolys;for(let t=0,r=this.rings.length;t<r;t++){const r=this.rings[t],o=this.windings[t],i=e.indexOf(r);-1===i?(e.push(r),n.push(o)):n[i]+=o}const o=[],i=[];for(let t=0,r=e.length;t<r;t++){if(0===n[t])continue;const r=e[t],s=r.poly;if(-1===i.indexOf(s))if(r.isExterior)o.push(s);else{-1===i.indexOf(s)&&i.push(s);const t=o.indexOf(r.poly);-1!==t&&o.splice(t,1)}}for(let t=0,e=o.length;t<e;t++){const e=o[t].multiPoly;-1===r.indexOf(e)&&r.push(e)}return this._afterState}isInResult(){if(this.consumedBy)return!1;if(void 0!==this._isInResult)return this._isInResult;const t=this.beforeState().multiPolys,e=this.afterState().multiPolys;switch(at.type){case"union":{const n=0===t.length,r=0===e.length;this._isInResult=n!==r;break}case"intersection":{let n,r;t.length<e.length?(n=t.length,r=e.length):(n=e.length,r=t.length),this._isInResult=r===at.numMultiPolys&&n<r;break}case"xor":{const n=Math.abs(t.length-e.length);this._isInResult=n%2==1;break}case"difference":{const n=t=>1===t.length&&t[0].isSubject;this._isInResult=n(t)!==n(e);break}default:throw new Error(`Unrecognized operation type found ${at.type}`)}return this._isInResult}}class W{constructor(t,e,n){if(!Array.isArray(t)||0===t.length)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=e,this.isExterior=n,this.segments=[],"number"!=typeof t[0][0]||"number"!=typeof t[0][1])throw new Error("Input geometry is not a valid Polygon or MultiPolygon");const r=x.round(t[0][0],t[0][1]);this.bbox={ll:{x:r.x,y:r.y},ur:{x:r.x,y:r.y}};let o=r;for(let e=1,n=t.length;e<n;e++){if("number"!=typeof t[e][0]||"number"!=typeof t[e][1])throw new Error("Input geometry is not a valid Polygon or MultiPolygon");let n=x.round(t[e][0],t[e][1]);n.x===o.x&&n.y===o.y||(this.segments.push(X.fromRing(o,n,this)),n.x<this.bbox.ll.x&&(this.bbox.ll.x=n.x),n.y<this.bbox.ll.y&&(this.bbox.ll.y=n.y),n.x>this.bbox.ur.x&&(this.bbox.ur.x=n.x),n.y>this.bbox.ur.y&&(this.bbox.ur.y=n.y),o=n)}r.x===o.x&&r.y===o.y||this.segments.push(X.fromRing(o,r,this))}getSweepEvents(){const t=[];for(let e=0,n=this.segments.length;e<n;e++){const n=this.segments[e];t.push(n.leftSE),t.push(n.rightSE)}return t}}class K{constructor(t,e){if(!Array.isArray(t))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new W(t[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(let e=1,n=t.length;e<n;e++){const n=new W(t[e],this,!1);n.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=n.bbox.ll.x),n.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=n.bbox.ll.y),n.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=n.bbox.ur.x),n.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=n.bbox.ur.y),this.interiorRings.push(n)}this.multiPoly=e}getSweepEvents(){const t=this.exteriorRing.getSweepEvents();for(let e=0,n=this.interiorRings.length;e<n;e++){const n=this.interiorRings[e].getSweepEvents();for(let e=0,r=n.length;e<r;e++)t.push(n[e])}return t}}class Q{constructor(t,e){if(!Array.isArray(t))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{"number"==typeof t[0][0][0]&&(t=[t])}catch(t){}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(let e=0,n=t.length;e<n;e++){const n=new K(t[e],this);n.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=n.bbox.ll.x),n.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=n.bbox.ll.y),n.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=n.bbox.ur.x),n.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=n.bbox.ur.y),this.polys.push(n)}this.isSubject=e}getSweepEvents(){const t=[];for(let e=0,n=this.polys.length;e<n;e++){const n=this.polys[e].getSweepEvents();for(let e=0,r=n.length;e<r;e++)t.push(n[e])}return t}}class tt{static factory(t){const e=[];for(let n=0,r=t.length;n<r;n++){const r=t[n];if(!r.isInResult()||r.ringOut)continue;let o=null,i=r.leftSE,s=r.rightSE;const a=[i],u=i.point,c=[];for(;o=i,i=s,a.push(i),i.point!==u;)for(;;){const t=i.getAvailableLinkedEvents();if(0===t.length){const t=a[0].point,e=a[a.length-1].point;throw new Error(`Unable to complete output ring starting at [${t.x}, ${t.y}]. Last matching segment found ends at [${e.x}, ${e.y}].`)}if(1===t.length){s=t[0].otherSE;break}let n=null;for(let t=0,e=c.length;t<e;t++)if(c[t].point===i.point){n=t;break}if(null!==n){const t=c.splice(n)[0],r=a.splice(t.index);r.unshift(r[0].otherSE),e.push(new tt(r.reverse()));continue}c.push({index:a.length,point:i.point});const r=i.getLeftmostComparator(o);s=t.sort(r)[0].otherSE;break}e.push(new tt(a))}return e}constructor(t){this.events=t;for(let e=0,n=t.length;e<n;e++)t[e].segment.ringOut=this;this.poly=null}getGeom(){let t=this.events[0].point;const e=[t];for(let n=1,r=this.events.length-1;n<r;n++){const r=this.events[n].point,o=this.events[n+1].point;0!==V(r,t,o)&&(e.push(r),t=r)}if(1===e.length)return null;const n=e[0],r=e[1];0===V(n,t,r)&&e.shift(),e.push(e[0]);const o=this.isExteriorRing()?1:-1,i=this.isExteriorRing()?0:e.length-1,s=this.isExteriorRing()?e.length:-1,a=[];for(let t=i;t!=s;t+=o)a.push([e[t].x,e[t].y]);return a}isExteriorRing(){if(void 0===this._isExteriorRing){const t=this.enclosingRing();this._isExteriorRing=!t||!t.isExteriorRing()}return this._isExteriorRing}enclosingRing(){return void 0===this._enclosingRing&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}_calcEnclosingRing(){let t=this.events[0];for(let e=1,n=this.events.length;e<n;e++){const n=this.events[e];H.compare(t,n)>0&&(t=n)}let e=t.segment.prevInResult(),n=e?e.prevInResult():null;for(;;){if(!e)return null;if(!n)return e.ringOut;if(n.ringOut!==e.ringOut)return n.ringOut.enclosingRing()!==e.ringOut?e.ringOut:e.ringOut.enclosingRing();e=n.prevInResult(),n=e?e.prevInResult():null}}}class et{constructor(t){this.exteriorRing=t,t.poly=this,this.interiorRings=[]}addInterior(t){this.interiorRings.push(t),t.poly=this}getGeom(){const t=[this.exteriorRing.getGeom()];if(null===t[0])return null;for(let e=0,n=this.interiorRings.length;e<n;e++){const n=this.interiorRings[e].getGeom();null!==n&&t.push(n)}return t}}class nt{constructor(t){this.rings=t,this.polys=this._composePolys(t)}getGeom(){const t=[];for(let e=0,n=this.polys.length;e<n;e++){const n=this.polys[e].getGeom();null!==n&&t.push(n)}return t}_composePolys(t){const e=[];for(let n=0,r=t.length;n<r;n++){const r=t[n];if(!r.poly)if(r.isExteriorRing())e.push(new et(r));else{const t=r.enclosingRing();t.poly||e.push(new et(t)),t.poly.addInterior(r)}}return e}}class rt{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:X.compare;this.queue=t,this.tree=new u(e),this.segments=[]}process(t){const e=t.segment,n=[];if(t.consumedBy)return t.isLeft?this.queue.remove(t.otherSE):this.tree.remove(e),n;const r=t.isLeft?this.tree.add(e):this.tree.find(e);if(!r)throw new Error(`Unable to find segment #${e.id} [${e.leftSE.point.x}, ${e.leftSE.point.y}] -> [${e.rightSE.point.x}, ${e.rightSE.point.y}] in SweepLine tree.`);let o,i,s=r,a=r;for(;void 0===o;)s=this.tree.prev(s),null===s?o=null:void 0===s.key.consumedBy&&(o=s.key);for(;void 0===i;)a=this.tree.next(a),null===a?i=null:void 0===a.key.consumedBy&&(i=a.key);if(t.isLeft){let r=null;if(o){const t=o.getIntersection(e);if(null!==t&&(e.isAnEndpoint(t)||(r=t),!o.isAnEndpoint(t))){const e=this._splitSafely(o,t);for(let t=0,r=e.length;t<r;t++)n.push(e[t])}}let s=null;if(i){const t=i.getIntersection(e);if(null!==t&&(e.isAnEndpoint(t)||(s=t),!i.isAnEndpoint(t))){const e=this._splitSafely(i,t);for(let t=0,r=e.length;t<r;t++)n.push(e[t])}}if(null!==r||null!==s){let t=null;t=null===r?s:null===s||H.comparePoints(r,s)<=0?r:s,this.queue.remove(e.rightSE),n.push(e.rightSE);const o=e.split(t);for(let t=0,e=o.length;t<e;t++)n.push(o[t])}n.length>0?(this.tree.remove(e),n.push(t)):(this.segments.push(e),e.prev=o)}else{if(o&&i){const t=o.getIntersection(i);if(null!==t){if(!o.isAnEndpoint(t)){const e=this._splitSafely(o,t);for(let t=0,r=e.length;t<r;t++)n.push(e[t])}if(!i.isAnEndpoint(t)){const e=this._splitSafely(i,t);for(let t=0,r=e.length;t<r;t++)n.push(e[t])}}}this.tree.remove(e)}return n}_splitSafely(t,e){this.tree.remove(t);const n=t.rightSE;this.queue.remove(n);const r=t.split(e);return r.push(n),void 0===t.consumedBy&&this.tree.add(t),r}}const ot="undefined"!=typeof process&&process.env.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,it="undefined"!=typeof process&&process.env.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6;class st{run(t,e,n){at.type=t,x.reset();const r=[new Q(e,!0)];for(let t=0,e=n.length;t<e;t++)r.push(new Q(n[t],!1));if(at.numMultiPolys=r.length,"difference"===at.type){const t=r[0];let e=1;for(;e<r.length;)null!==y(r[e].bbox,t.bbox)?e++:r.splice(e,1)}if("intersection"===at.type)for(let t=0,e=r.length;t<e;t++){const e=r[t];for(let n=t+1,o=r.length;n<o;n++)if(null===y(e.bbox,r[n].bbox))return[]}const o=new u(H.compare);for(let t=0,e=r.length;t<e;t++){const e=r[t].getSweepEvents();for(let t=0,n=e.length;t<n;t++)if(o.insert(e[t]),o.size>ot)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big).")}const i=new rt(o);let s=o.size,a=o.pop();for(;a;){const t=a.key;if(o.size===s){const e=t.segment;throw new Error(`Unable to pop() ${t.isLeft?"left":"right"} SweepEvent [${t.point.x}, ${t.point.y}] from segment #${e.id} [${e.leftSE.point.x}, ${e.leftSE.point.y}] -> [${e.rightSE.point.x}, ${e.rightSE.point.y}] from queue.`)}if(o.size>ot)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big).");if(i.segments.length>it)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments).");const e=i.process(t);for(let t=0,n=e.length;t<n;t++){const n=e[t];void 0===n.consumedBy&&o.insert(n)}s=o.size,a=o.pop()}x.reset();const c=tt.factory(i.segments);return new nt(c).getGeom()}}const at=new st,ut=function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return at.run("union",t,n)},ct=function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return at.run("intersection",t,n)},lt=function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return at.run("xor",t,n)},pt=function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return at.run("difference",t,n)};return{union:ut,intersection:ct,xor:lt,difference:pt}}()}},e={};function n(r){var o=e[r];if(void 0!==o)return o.exports;var i=e[r]={exports:{}};return t[r].call(i.exports,i,i.exports,n),i.exports}n.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return n.d(e,{a:e}),e},n.d=(t,e)=>{for(var r in e)n.o(e,r)&&!n.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:e[r]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),n.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var r={};(()=>{"use strict";n.r(r),n.d(r,{SnapDirectSelect:()=>Xt,SnapModeDrawStyles:()=>Wt,SnapPolygonMode:()=>Jt,Utils:()=>t});var t={};n.r(t),n.d(t,{IDS:()=>Ot,addPointTovertices:()=>Ct,createSnapList:()=>Tt,getGuideFeature:()=>Nt,shouldHideGuide:()=>Ft,snap:()=>At});var e=n(568),o=n.n(e),i=6371008.8,s={centimeters:637100880,centimetres:637100880,degrees:360/(2*Math.PI),feet:20902260.511392,inches:39.37*i,kilometers:6371.0088,kilometres:6371.0088,meters:i,metres:i,miles:3958.761333810546,millimeters:6371008800,millimetres:6371008800,nauticalmiles:i/1852,radians:1,yards:6967335.223679999};function a(t,e,n={}){const r={type:"Feature"};return(0===n.id||n.id)&&(r.id=n.id),n.bbox&&(r.bbox=n.bbox),r.properties=e||{},r.geometry=t,r}function u(t,e,n={}){if(!t)throw new Error("coordinates is required");if(!Array.isArray(t))throw new Error("coordinates must be an Array");if(t.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!v(t[0])||!v(t[1]))throw new Error("coordinates must contain numbers");return a({type:"Point",coordinates:t},e,n)}function c(t,e,n={}){for(const e of t){if(e.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(e[e.length-1].length!==e[0].length)throw new Error("First and last Position are not equivalent.");for(let t=0;t<e[e.length-1].length;t++)if(e[e.length-1][t]!==e[0][t])throw new Error("First and last Position are not equivalent.")}return a({type:"Polygon",coordinates:t},e,n)}function l(t,e,n={}){if(t.length<2)throw new Error("coordinates must be an array of two or more positions");return a({type:"LineString",coordinates:t},e,n)}function p(t,e={}){const n={type:"FeatureCollection"};return e.id&&(n.id=e.id),e.bbox&&(n.bbox=e.bbox),n.features=t,n}function h(t,e,n={}){return a({type:"MultiLineString",coordinates:t},e,n)}function f(t,e,n={}){return a({type:"MultiPolygon",coordinates:t},e,n)}function d(t,e="kilometers"){const n=s[e];if(!n)throw new Error(e+" units is invalid");return t*n}function g(t,e="kilometers"){const n=s[e];if(!n)throw new Error(e+" units is invalid");return t/n}function y(t){return 180*(t%(2*Math.PI))/Math.PI}function m(t){return t%360*Math.PI/180}function v(t){return!isNaN(t)&&null!==t&&!Array.isArray(t)}var b=function(t,e={}){const n=Number(t[0]),r=Number(t[1]),o=Number(t[2]),i=Number(t[3]);if(6===t.length)throw new Error("@turf/bbox-polygon does not support BBox with 6 positions");const s=[n,r];return c([[s,[o,r],[o,i],[n,i],s]],e.properties,{bbox:t,id:e.id})};const E=function(t,e){for(var n=0,r=0,o=0,i=0,s=0,a=0,u=0,c=0,l=null,p=null,h=t[0],f=t[1],d=e.length;n<d;n++){r=0;var g=e[n].length-1,y=e[n];if((l=y[0])[0]!==y[g][0]&&l[1]!==y[g][1])throw new Error("First and last coordinates in a ring must be the same");for(s=l[0]-h,a=l[1]-f;r<g;r++)if(c=(p=y[r+1])[1]-f,a<0&&c<0||a>0&&c>0)a=c,s=(l=p)[0]-h;else{if(u=p[0]-t[0],c>0&&a<=0){if((i=s*c-u*a)>0)o+=1;else if(0===i)return 0}else if(a>0&&c<=0){if((i=s*c-u*a)<0)o+=1;else if(0===i)return 0}else if(0===c&&a<0){if(0===(i=s*c-u*a))return 0}else if(0===a&&c<0){if(0===(i=s*c-u*a))return 0}else if(0===a&&0===c){if(u<=0&&s>=0)return 0;if(s<=0&&u>=0)return 0}l=p,a=c,s=u}}return o%2!=0};function _(t){if(!t)throw new Error("coord is required");if(!Array.isArray(t)){if("Feature"===t.type&&null!==t.geometry&&"Point"===t.geometry.type)return[...t.geometry.coordinates];if("Point"===t.type)return[...t.coordinates]}if(Array.isArray(t)&&t.length>=2&&!Array.isArray(t[0])&&!Array.isArray(t[1]))return[...t];throw new Error("coord must be GeoJSON Point or an Array of numbers")}function x(t){if(Array.isArray(t))return t;if("Feature"===t.type){if(null!==t.geometry)return t.geometry.coordinates}else if(t.coordinates)return t.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function S(t){return"Feature"===t.type?t.geometry:t}function w(t,e,n={}){if(!t)throw new Error("point is required");if(!e)throw new Error("polygon is required");const r=_(t),o=S(e),i=o.type,s=e.bbox;let a=o.coordinates;if(s&&!1===function(t,e){return e[0]<=t[0]&&e[1]<=t[1]&&e[2]>=t[0]&&e[3]>=t[1]}(r,s))return!1;"Polygon"===i&&(a=[a]);let u=!1;for(var c=0;c<a.length;++c){const t=E(r,a[c]);if(0===t)return!n.ignoreBoundary;t&&(u=!0)}return u}class I{constructor(t=[],e=O){if(this.data=t,this.length=this.data.length,this.compare=e,this.length>0)for(let t=(this.length>>1)-1;t>=0;t--)this._down(t)}push(t){this.data.push(t),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;const t=this.data[0],e=this.data.pop();return this.length--,this.length>0&&(this.data[0]=e,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:e,compare:n}=this,r=e[t];for(;t>0;){const o=t-1>>1,i=e[o];if(n(r,i)>=0)break;e[t]=i,t=o}e[t]=r}_down(t){const{data:e,compare:n}=this,r=this.length>>1,o=e[t];for(;t<r;){let r=1+(t<<1),i=e[r];const s=r+1;if(s<this.length&&n(e[s],i)<0&&(r=s,i=e[s]),n(i,o)>=0)break;e[t]=i,t=r}e[t]=o}}function O(t,e){return t<e?-1:t>e?1:0}function C(t,e){return t.p.x>e.p.x?1:t.p.x<e.p.x?-1:t.p.y!==e.p.y?t.p.y>e.p.y?1:-1:1}function T(t,e){return t.rightSweepEvent.p.x>e.rightSweepEvent.p.x?1:t.rightSweepEvent.p.x<e.rightSweepEvent.p.x?-1:t.rightSweepEvent.p.y!==e.rightSweepEvent.p.y?t.rightSweepEvent.p.y<e.rightSweepEvent.p.y?1:-1:1}class P{constructor(t,e,n,r){this.p={x:t[0],y:t[1]},this.featureId=e,this.ringId=n,this.eventId=r,this.otherEvent=null,this.isLeftEndpoint=null}isSamePoint(t){return this.p.x===t.p.x&&this.p.y===t.p.y}}let M=0,L=0,A=0;function N(t,e){const n="Feature"===t.type?t.geometry:t;let r=n.coordinates;"Polygon"!==n.type&&"MultiLineString"!==n.type||(r=[r]),"LineString"===n.type&&(r=[[r]]);for(let t=0;t<r.length;t++)for(let n=0;n<r[t].length;n++){let o=r[t][n][0],i=null;L+=1;for(let s=0;s<r[t][n].length-1;s++){i=r[t][n][s+1];const a=new P(o,M,L,A),u=new P(i,M,L,A+1);a.otherEvent=u,u.otherEvent=a,C(a,u)>0?(u.isLeftEndpoint=!0,a.isLeftEndpoint=!1):(a.isLeftEndpoint=!0,u.isLeftEndpoint=!1),e.push(a),e.push(u),o=i,A+=1}}M+=1}class F{constructor(t){this.leftSweepEvent=t,this.rightSweepEvent=t.otherEvent}}function R(t,e){if(null===t||null===e)return!1;if(t.leftSweepEvent.ringId===e.leftSweepEvent.ringId&&(t.rightSweepEvent.isSamePoint(e.leftSweepEvent)||t.rightSweepEvent.isSamePoint(e.leftSweepEvent)||t.rightSweepEvent.isSamePoint(e.rightSweepEvent)||t.leftSweepEvent.isSamePoint(e.leftSweepEvent)||t.leftSweepEvent.isSamePoint(e.rightSweepEvent)))return!1;const n=t.leftSweepEvent.p.x,r=t.leftSweepEvent.p.y,o=t.rightSweepEvent.p.x,i=t.rightSweepEvent.p.y,s=e.leftSweepEvent.p.x,a=e.leftSweepEvent.p.y,u=e.rightSweepEvent.p.x,c=e.rightSweepEvent.p.y,l=(c-a)*(o-n)-(u-s)*(i-r),p=(u-s)*(r-a)-(c-a)*(n-s),h=(o-n)*(r-a)-(i-r)*(n-s);if(0===l)return!1;const f=p/l,d=h/l;if(f>=0&&f<=1&&d>=0&&d<=1){return[n+f*(o-n),r+f*(i-r)]}return!1}var k=function(t,e){const n=new I([],C);return function(t,e){if("FeatureCollection"===t.type){const n=t.features;for(let t=0;t<n.length;t++)N(n[t],e)}else N(t,e)}(t,n),function(t,e){e=e||!1;const n=[],r=new I([],T);for(;t.length;){const o=t.pop();if(o.isLeftEndpoint){const t=new F(o);for(let i=0;i<r.data.length;i++){const s=r.data[i];if(e&&s.leftSweepEvent.featureId===o.featureId)continue;const a=R(t,s);!1!==a&&n.push(a)}r.push(t)}else!1===o.isLeftEndpoint&&r.pop()}return n}(n,e)};function D(t,e,n={}){const{removeDuplicates:r=!0,ignoreSelfIntersections:o=!1}=n;let i=[];"FeatureCollection"===t.type?i=i.concat(t.features):"Feature"===t.type?i.push(t):"LineString"!==t.type&&"Polygon"!==t.type&&"MultiLineString"!==t.type&&"MultiPolygon"!==t.type||i.push(a(t)),"FeatureCollection"===e.type?i=i.concat(e.features):"Feature"===e.type?i.push(e):"LineString"!==e.type&&"Polygon"!==e.type&&"MultiLineString"!==e.type&&"MultiPolygon"!==e.type||i.push(a(e));const s=k(p(i),o);let c=[];if(r){const t={};s.forEach((e=>{const n=e.join(",");t[n]||(t[n]=!0,c.push(e))}))}else c=s;return p(c.map((t=>u(t))))}function U(t,e){if("Feature"===t.type)e(t,0);else if("FeatureCollection"===t.type)for(var n=0;n<t.features.length&&!1!==e(t.features[n],n);n++);}function j(t,e){var n,r,o,i,s,a,u,c,l,p,h=0,f="FeatureCollection"===t.type,d="Feature"===t.type,g=f?t.features.length:1;for(n=0;n<g;n++){for(a=f?t.features[n].geometry:d?t.geometry:t,c=f?t.features[n].properties:d?t.properties:{},l=f?t.features[n].bbox:d?t.bbox:void 0,p=f?t.features[n].id:d?t.id:void 0,s=(u=!!a&&"GeometryCollection"===a.type)?a.geometries.length:1,o=0;o<s;o++)if(null!==(i=u?a.geometries[o]:a))switch(i.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":if(!1===e(i,h,c,l,p))return!1;break;case"GeometryCollection":for(r=0;r<i.geometries.length;r++)if(!1===e(i.geometries[r],h,c,l,p))return!1;break;default:throw new Error("Unknown Geometry Type")}else if(!1===e(null,h,c,l,p))return!1;h++}}function G(t,e){j(t,(function(t,n,r,o,i){var s,u=null===t?null:t.type;switch(u){case null:case"Point":case"LineString":case"Polygon":return!1!==e(a(t,r,{bbox:o,id:i}),n,0)&&void 0}switch(u){case"MultiPoint":s="Point";break;case"MultiLineString":s="LineString";break;case"MultiPolygon":s="Polygon"}for(var c=0;c<t.coordinates.length;c++){var l=t.coordinates[c];if(!1===e(a({type:s,coordinates:l},r),n,c))return!1}}))}function V(t,e={}){const n=S(t);switch(e.properties||"Feature"!==t.type||(e.properties=t.properties),n.type){case"Polygon":return function(t,e={}){const n=S(t),r=n.coordinates,o=e.properties?e.properties:"Feature"===t.type?t.properties:{};return B(r,o)}(n,e);case"MultiPolygon":return function(t,e={}){const n=S(t),r=n.coordinates,o=e.properties?e.properties:"Feature"===t.type?t.properties:{},i=[];return r.forEach((t=>{i.push(B(t,o))})),p(i)}(n,e);default:throw new Error("invalid poly")}}function B(t,e){return t.length>1?h(t,e):l(t[0],e)}var z=V;function $(t,e,n={}){var r;const o=null!=(r=n.ignoreSelfIntersections)&&r;let i=!0;return G(t,(t=>{G(e,(e=>{if(!1===i)return!1;i=function(t,e,n){switch(t.type){case"Point":switch(e.type){case"Point":return r=t.coordinates,o=e.coordinates,!(r[0]===o[0]&&r[1]===o[1]);case"LineString":return!J(e,t);case"Polygon":return!w(t,e)}break;case"LineString":switch(e.type){case"Point":return!J(t,e);case"LineString":return!function(t,e,n){const r=D(t,e,{ignoreSelfIntersections:n});if(r.features.length>0)return!0;return!1}(t,e,n);case"Polygon":return!q(e,t,n)}break;case"Polygon":switch(e.type){case"Point":return!w(e,t);case"LineString":return!q(t,e,n);case"Polygon":return!function(t,e,n){for(const n of t.coordinates[0])if(w(n,e))return!0;for(const n of e.coordinates[0])if(w(n,t))return!0;const r=D(V(t),V(e),{ignoreSelfIntersections:n});if(r.features.length>0)return!0;return!1}(e,t,n)}}var r,o;return!1}(t.geometry,e.geometry,o)}))})),i}function J(t,e){for(let n=0;n<t.coordinates.length-1;n++)if(Y(t.coordinates[n],t.coordinates[n+1],e.coordinates))return!0;return!1}function q(t,e,n){for(const n of e.coordinates)if(w(n,t))return!0;return D(e,V(t),{ignoreSelfIntersections:n}).features.length>0}function Y(t,e,n){const r=n[0]-t[0],o=n[1]-t[1],i=e[0]-t[0],s=e[1]-t[1];return 0==r*s-o*i&&(Math.abs(i)>=Math.abs(s)?i>0?t[0]<=n[0]&&n[0]<=e[0]:e[0]<=n[0]&&n[0]<=t[0]:s>0?t[1]<=n[1]&&n[1]<=e[1]:e[1]<=n[1]&&n[1]<=t[1])}var H=$;function Z(t,e,n={}){var r=_(t),o=_(e),i=m(o[1]-r[1]),s=m(o[0]-r[0]),a=m(r[1]),u=m(o[1]),c=Math.pow(Math.sin(i/2),2)+Math.pow(Math.sin(s/2),2)*Math.cos(a)*Math.cos(u);return d(2*Math.atan2(Math.sqrt(c),Math.sqrt(1-c)),n.units)}var X=Z;function W(t,e,n={}){if(!0===n.final)return function(t,e){let n=W(e,t);return n=(n+180)%360,n}(t,e);const r=_(t),o=_(e),i=m(r[0]),s=m(o[0]),a=m(r[1]),u=m(o[1]),c=Math.sin(s-i)*Math.cos(u),l=Math.cos(a)*Math.sin(u)-Math.sin(a)*Math.cos(u)*Math.cos(s-i);return y(Math.atan2(c,l))}function K(t,e,n,r={}){const o=_(t),i=m(o[0]),s=m(o[1]),a=m(n),c=g(e,r.units),l=Math.asin(Math.sin(s)*Math.cos(c)+Math.cos(s)*Math.sin(c)*Math.cos(a));return u([y(i+Math.atan2(Math.sin(a)*Math.sin(c)*Math.cos(s),Math.cos(c)-Math.sin(s)*Math.sin(l))),y(l)],r.properties)}var Q=Object.defineProperty,tt=Object.defineProperties,et=Object.getOwnPropertyDescriptors,nt=Object.getOwnPropertySymbols,rt=Object.prototype.hasOwnProperty,ot=Object.prototype.propertyIsEnumerable,it=(t,e,n)=>e in t?Q(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,st=(t,e)=>{for(var n in e||(e={}))rt.call(e,n)&&it(t,n,e[n]);if(nt)for(var n of nt(e))ot.call(e,n)&&it(t,n,e[n]);return t},at=(t,e)=>tt(t,et(e));var ut=function(t,e,n={}){if(!t||!e)throw new Error("lines and pt are required arguments");let r=u([1/0,1/0],{dist:1/0,index:-1,multiFeatureIndex:-1,location:-1}),o=0;return G(t,(function(t,i,s){const a=x(t);for(let t=0;t<a.length-1;t++){const i=u(a[t]);i.properties.dist=Z(e,i,n);const c=u(a[t+1]);c.properties.dist=Z(e,c,n);const p=Z(i,c,n),h=Math.max(i.properties.dist,c.properties.dist),f=W(i,c),d=K(e,h,f+90,n),g=K(e,h,f-90,n),y=D(l([d.geometry.coordinates,g.geometry.coordinates]),l([i.geometry.coordinates,c.geometry.coordinates]));let m;y.features.length>0&&y.features[0]&&(m=at(st({},y.features[0]),{properties:{dist:Z(e,y.features[0],n),multiFeatureIndex:s,location:o+Z(i,y.features[0],n)}})),i.properties.dist<r.properties.dist&&(r=at(st({},i),{properties:at(st({},i.properties),{index:t,multiFeatureIndex:s,location:o})})),c.properties.dist<r.properties.dist&&(r=at(st({},c),{properties:at(st({},c.properties),{index:t+1,multiFeatureIndex:s,location:o+p})})),m&&m.properties.dist<r.properties.dist&&(r=at(st({},m),{properties:at(st({},m.properties),{index:t})})),o+=p}})),r};function ct(t){if(!t)throw new Error("geojson is required");switch(t.type){case"Feature":return lt(t);case"FeatureCollection":return function(t){const e={type:"FeatureCollection"};return Object.keys(t).forEach((n=>{switch(n){case"type":case"features":return;default:e[n]=t[n]}})),e.features=t.features.map((t=>lt(t))),e}(t);case"Point":case"LineString":case"Polygon":case"MultiPoint":case"MultiLineString":case"MultiPolygon":case"GeometryCollection":return ht(t);default:throw new Error("unknown GeoJSON type")}}function lt(t){const e={type:"Feature"};return Object.keys(t).forEach((n=>{switch(n){case"type":case"properties":case"geometry":return;default:e[n]=t[n]}})),e.properties=pt(t.properties),null==t.geometry?e.geometry=null:e.geometry=ht(t.geometry),e}function pt(t){const e={};return t?(Object.keys(t).forEach((n=>{const r=t[n];"object"==typeof r?null===r?e[n]=null:Array.isArray(r)?e[n]=r.map((t=>t)):e[n]=pt(r):e[n]=r})),e):e}function ht(t){const e={type:t.type};return t.bbox&&(e.bbox=t.bbox),"GeometryCollection"===t.type?(e.geometries=t.geometries.map((t=>ht(t))),e):(e.coordinates=ft(t.coordinates),e)}function ft(t){const e=t;return"object"!=typeof e[0]?e.slice():e.map((t=>ft(t)))}var dt=Object.defineProperty,gt=Object.defineProperties,yt=Object.getOwnPropertyDescriptors,mt=Object.getOwnPropertySymbols,vt=Object.prototype.hasOwnProperty,bt=Object.prototype.propertyIsEnumerable,Et=(t,e,n)=>e in t?dt(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,_t=(t,e)=>{for(var n in e||(e={}))vt.call(e,n)&&Et(t,n,e[n]);if(mt)for(var n of mt(e))bt.call(e,n)&&Et(t,n,e[n]);return t},xt=(t,e)=>gt(t,yt(e));var St=function(t,e,n={}){if(!t)throw new Error("targetPoint is required");if(!e)throw new Error("points is required");let r=1/0,o=0;U(e,((e,i)=>{const s=Z(t,e,n);s<r&&(o=i,r=s)}));const i=ct(e.features[o]);return xt(_t({},i),{properties:xt(_t({},i.properties),{featureIndex:o,distanceToPoint:r})})};var wt=function(t,e){return K(t,Z(t,e)/2,W(t,e))};const{geojsonTypes:It}=o().constants,Ot={VERTICAL_GUIDE:"VERTICAL_GUIDE",HORIZONTAL_GUIDE:"HORIZONTAL_GUIDE"},Ct=(t,e,n,r)=>{const{width:o,height:i}=t.getCanvas(),{x:s,y:a}=t.project(n);(s>0&&s<o&&a>0&&a<i||r)&&e.push(n)},Tt=(t,e,n,r=[])=>{const o=r.map((e=>{const n=t.getSource(e);if("geojson"===(null==n?void 0:n.type)){const t=n._data;return t&&"string"!=typeof t?"FeatureCollection"===t.type?t.features:"Feature"===t.type?[t]:[]:[]}return[]})).flat(),i=e.getAll().features.concat(o),s=[],a=(()=>{const e=t.getCanvas(),n=e.width,r=e.height,o=(t.unproject([0,0]).toArray(),t.unproject([n,0]).toArray()),i=(t.unproject([n,r]).toArray(),t.unproject([0,r]).toArray());return b([i,o].flat())})(),u=[],c=(e,n=!1)=>{if(!Array.isArray(e))throw Error("Your array is not an array");Array.isArray(e[0])?e.forEach((t=>{c(t)})):2===e.length&&Ct(t,u,e,n)};return i.forEach((t=>{t.id!==n.id?t.id!==Ot.HORIZONTAL_GUIDE&&t.id!==Ot.VERTICAL_GUIDE&&("GeometryCollection"!==t.geometry.type&&"Point"!==t.geometry.type&&c(t.geometry.coordinates),H(a,t)||s.push(t)):n.type===It.POLYGON&&"GeometryCollection"!==t.geometry.type&&"Point"!==t.geometry.type&&c(t.geometry.coordinates[0].slice(0,-2),!0)})),[s,u]};function Pt(t,e){const n=t.map((t=>({feature:t,point:ut(t,e)})));return n.sort(((t,e)=>t.point.properties.dist-e.point.properties.dist)),{feature:n[0].feature,point:n[0].point}}const Mt=(t,e)=>{let n={};return e.forEach(((e,r)=>{const o=((t,e)=>{const n=[t.lng,t.lat],r="Point"===e.geometry.type,o="Polygon"===e.geometry.type,i="MultiPolygon"===e.geometry.type,s="MultiPoint"===e.geometry.type;let a;const c=x(e);if(r){const[t,e]=c;return{latlng:{lng:t,lat:e},distance:X(c,n)}}if(s){const t=St(n,p(c.map((t=>u(t))))),e=t.geometry.coordinates;return{latlng:{lng:e[0],lat:e[1]},distance:t.properties.distanceToPoint}}let h;if(a=o||i?z(e):e,o){let t;t="LineString"===a.geometry.type?[l(a.geometry.coordinates)]:a.geometry.coordinates.map((t=>l(t)));const e=Pt(t,n);a=e.feature,h=e.point}else if(i){const t=Pt(a.features.map((t=>"LineString"===t.geometry.type?[t.geometry.coordinates]:t.geometry.coordinates)).flatMap((t=>t)).map((t=>l(t))),n);a=t.feature,h=t.point}else h=ut(a,n);const[f,d]=h.geometry.coordinates;let g=h.properties.index;return g+1===a.geometry.coordinates.length&&g--,{latlng:{lng:f,lat:d},segment:a.geometry.coordinates.slice(g,g+2),distance:h.properties.dist,isMarker:r}})(t,e);(void 0===n.distance||o.distance<n.distance)&&(n=o,n.layer=e)})),n};const Lt=(t,e,n=1.25)=>!Array.isArray(t.segment)?function(t){return t.latlng}(t):function(t,e,n){const r=t.segment[0],o=t.segment[1],i=[t.latlng.lng,t.latlng.lat],s=X(r,i),a=X(o,i);let u,c=s<a?r:o,l=s<a?s:a;if(e&&e.snapToMidPoints){const t=wt(r,o).geometry.coordinates,e=X(t,i);e<s&&e<a&&(c=t,l=e)}u=l<n?c:i;const[p,h]=u;return{lng:p,lat:h}}(t,e,n),At=(t,e)=>{let n,r,o,i,s,a=e.lngLat.lng,u=e.lngLat.lat;if(e.originalEvent.altKey)return t.showVerticalSnapLine=!1,t.showHorizontalSnapLine=!1,{lng:a,lat:u};if(t.snapList.length<=0)return{lng:a,lat:u};if(t.options.snap){if(n=Mt({lng:a,lat:u},t.snapList),0===Object.keys(n).length)return!1;const e=n.isMarker,i=t.options.snapOptions?t.options.snapOptions.snapVertexPriorityDistance:void 0;o=e?n.latlng:Lt(n,t.options.snapOptions,i),r=(t.options.snapOptions&&t.options.snapOptions.snapPx||15)*function(t,e){const n=t*(Math.PI/180);return 40075017*Math.cos(n)/Math.pow(2,e+8)}(o.lat,t.map.getZoom())}if(t.options.guides){const n=((t,e)=>{const n=[],r=[];return t.forEach((t=>{n.push(t[0]),r.push(t[1])})),{verticalPx:n.find((t=>Math.abs(t-e.lng)<.009)),horizontalPx:r.find((t=>Math.abs(t-e.lat)<.009))}})(t.vertices,e.lngLat);if(i=n.verticalPx,s=n.horizontalPx,i){const n={lng:i,lat:e.lngLat.lat+10},r={lng:i,lat:e.lngLat.lat-10};t.verticalGuide.updateCoordinate(0,n.lng,n.lat),t.verticalGuide.updateCoordinate(1,r.lng,r.lat)}if(s){const n={lng:e.lngLat.lng+10,lat:s},r={lng:e.lngLat.lng-10,lat:s};t.horizontalGuide.updateCoordinate(0,n.lng,n.lat),t.horizontalGuide.updateCoordinate(1,r.lng,r.lat)}t.showVerticalSnapLine=!!i,t.showHorizontalSnapLine=!!s}return r&&n&&1e3*n.distance<r?o:i||s?(i&&(a=i),s&&(u=s),{lng:a,lat:u}):{lng:a,lat:u}},Nt=t=>({id:t,type:It.FEATURE,properties:{isSnapGuide:"true"},geometry:{type:It.LINE_STRING,coordinates:[]}}),Ft=(t,e)=>!(e.properties.id!==Ot.VERTICAL_GUIDE||t.options.guides&&t.showVerticalSnapLine)||!(e.properties.id!==Ot.HORIZONTAL_GUIDE||t.options.guides&&t.showHorizontalSnapLine);var Rt=function(t,e,n={}){var r;const o=null!=(r=n.ignoreSelfIntersections)&&r;let i=!1;return G(t,(t=>{G(e,(e=>{if(!0===i)return!0;i=!$(t.geometry,e.geometry,{ignoreSelfIntersections:o})}))})),i},kt=n(180);function Dt(t,e){var n,r,o,i,s,a,u,c,l,p,h=0,f="FeatureCollection"===t.type,d="Feature"===t.type,g=f?t.features.length:1;for(n=0;n<g;n++){for(a=f?t.features[n].geometry:d?t.geometry:t,c=f?t.features[n].properties:d?t.properties:{},l=f?t.features[n].bbox:d?t.bbox:void 0,p=f?t.features[n].id:d?t.id:void 0,s=(u=!!a&&"GeometryCollection"===a.type)?a.geometries.length:1,o=0;o<s;o++)if(null!==(i=u?a.geometries[o]:a))switch(i.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":if(!1===e(i,h,c,l,p))return!1;break;case"GeometryCollection":for(r=0;r<i.geometries.length;r++)if(!1===e(i.geometries[r],h,c,l,p))return!1;break;default:throw new Error("Unknown Geometry Type")}else if(!1===e(null,h,c,l,p))return!1;h++}}function Ut(t){const e=[];if(Dt(t,(t=>{e.push(t.coordinates)})),e.length<2)throw new Error("Must have at least two features");const n=t.features[0].properties||{},r=kt.difference(e[0],...e.slice(1));return 0===r.length?null:1===r.length?c(r[0],n):f(r,n)}const{geojsonTypes:jt,modes:Gt,cursors:Vt}=o().constants,{doubleClickZoom:Bt}=o().lib,zt=o().modes.draw_polygon,$t=Object.assign({},zt);$t.onSetup=function(t){const e=this.newFeature({type:jt.FEATURE,properties:{},geometry:{type:jt.POLYGON,coordinates:[[]]}}),n=this.newFeature(Nt(Ot.VERTICAL_GUIDE)),r=this.newFeature(Nt(Ot.HORIZONTAL_GUIDE));this.addFeature(e),this.addFeature(n),this.addFeature(r);const o=this.getSelected();this.clearSelectedFeatures(),Bt.disable(this);const[i,s]=Tt(this.map,this._ctx.api,e,this._ctx.options.snapOptions.sources),a={map:this.map,polygon:e,currentVertexPosition:0,vertices:s,snapList:i,selectedFeatures:o,verticalGuide:n,horizontalGuide:r,snappedLat:0,snappedLng:0,ghostPoint:u([0,0],{meta:"feature",active:"true"}),options:Object.assign(this._ctx.options,{overlap:!0})},c=()=>{const[t,n]=Tt(this.map,this._ctx.api,e,a.options.snapOptions.sources);a.vertices=n,a.snapList=t};a.moveendCallback=c;const l=t=>{a.options=t};return a.optionsChangedCallBAck=l,this.map.on("moveend",c),this.map.on("draw.snap.options_changed",l),a},$t.onClick=function(t,n){const r=t.snappedLng,o=t.snappedLat;if(t.currentVertexPosition>0&&(this.updateUIClasses({mouse:Vt.POINTER}),e.lib.CommonSelectors.isVertex(n)))return this.changeMode(Gt.SIMPLE_SELECT,{featureIds:[t.polygon.id]});Ct(t.map,t.vertices,{lng:r,lat:o}),t.polygon.updateCoordinate(`0.${t.currentVertexPosition}`,r,o),t.currentVertexPosition++,t.polygon.updateCoordinate(`0.${t.currentVertexPosition}`,r,o)},$t.onMouseMove=function(t,n){const{lng:r,lat:o}=At(t,n);t.snappedLng=r,t.snappedLat=o,t.ghostPoint.geometry.coordinates=[r,o],t.polygon.updateCoordinate(`0.${t.currentVertexPosition}`,r,o),e.lib.CommonSelectors.isVertex(n)?this.updateUIClasses({mouse:Vt.POINTER}):this.updateUIClasses({mouse:Vt.ADD})},$t.toDisplayFeatures=function(t,e,n){Ft(t,e)||(n(t.ghostPoint),zt.toDisplayFeatures(t,e,n))},$t.onStop=function(t){this.deleteFeature(Ot.VERTICAL_GUIDE,{silent:!0}),this.deleteFeature(Ot.HORIZONTAL_GUIDE,{silent:!0}),this.map.off("moveend",t.moveendCallback),this.map.off("draw.snap.options_changed",t.optionsChangedCallBAck);var e=t.polygon;if(t.options.overlap)zt.onStop.call(this,t);else{var n=this._ctx.store.getAll();try{var r=e;n.forEach((function(t){if(e.id===t.id)return!1;Rt(t,r)&&(r=Ut(p([r,t])))})),t.polygon.coordinates=r.coordinates||r.geometry.coordinates}catch(e){return zt.onStop.call(this,t),void this.deleteFeature(t.polygon.id,{silent:!0})}var o=t.polygon.removeCoordinate;t.polygon.removeCoordinate=()=>{},zt.onStop.call(this,t),t.polygon.removeCoordinate=o.bind(t.polygon)}};const Jt=$t,{doubleClickZoom:qt}=o().lib,Yt=o().modes.direct_select,Ht=o().constants,Zt=Object.assign({},Yt);Zt.onSetup=function(t){const e=t.featureId,n=this.getFeature(e);if(!n)throw new Error("You must provide a featureId to enter direct_select mode");if(n.type===Ht.geojsonTypes.POINT)throw new TypeError("direct_select mode doesn't handle point features");const[r,o]=Tt(this.map,this._ctx.api,n,this._ctx.options.snapOptions.sources),i=this.newFeature(Nt(Ot.VERTICAL_GUIDE)),s=this.newFeature(Nt(Ot.HORIZONTAL_GUIDE));this.addFeature(i),this.addFeature(s);const a={map:this.map,featureId:e,feature:n,dragMoveLocation:t.startPos||null,dragMoving:!1,canDragMove:!1,selectedCoordPaths:t.coordPath?[t.coordPath]:[],vertices:o,snapList:r,verticalGuide:i,horizontalGuide:s,options:{},optionsChangedCallBAck:t=>{}};a.options=this._ctx.options,this.setSelectedCoordinates(this.pathsToCoordinates(e,a.selectedCoordPaths)),this.setSelected(e),qt.disable(this),this.setActionableState({trash:!0,combineFeatures:!1,uncombineFeatures:!1});const u=t=>{a.options=t};return a.optionsChangedCallBAck=u,this.map.on("draw.snap.options_changed",u),a},Zt.dragVertex=function(t,e,n){const{lng:r,lat:o}=At(t,e);t.feature.updateCoordinate(t.selectedCoordPaths[0],r,o)},Zt.onStop=function(t){var e;this.deleteFeature(Ot.VERTICAL_GUIDE,{silent:!0}),this.deleteFeature(Ot.HORIZONTAL_GUIDE,{silent:!0}),this.map.off("draw.snap.options_changed",t.optionsChangedCallBAck),null===(e=Yt.onStop)||void 0===e||e.call(this,t)};const Xt=Zt,Wt=[...e.lib.theme.map((t=>"gl-draw-line-inactive"===t.id?Object.assign(Object.assign({},t),{filter:[...(null==t?void 0:t.filter)||[],["!=","user_isSnapGuide","true"]]}):t)),{id:"guide",type:"line",filter:["all",["==","$type","LineString"],["==","user_isSnapGuide","true"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#c00c00","line-width":1,"line-dasharray":[5,5]}}]})(),mapboxGlDrawSnapOnMode=r})();
//# sourceMappingURL=index.js.map